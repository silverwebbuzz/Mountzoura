import { __awaiter, __decorate } from "tslib";
import { Component, EventEmitter, Input, Output } from '@angular/core';
import { AngularFireAuth } from '@angular/fire/auth';
import { MatDialog } from '@angular/material/dialog';
import { UserComponent } from '..';
let NgxAuthFirebaseuiAvatarComponent = class NgxAuthFirebaseuiAvatarComponent {
    constructor(afa, dialog) {
        this.afa = afa;
        this.dialog = dialog;
        this.layout = 'default';
        this.canLogout = true;
        this.canViewAccount = true;
        this.canDeleteAccount = true;
        this.canEditAccount = true;
        this.textProfile = 'Profile';
        this.textSignOut = 'Sign Out';
        // tslint:disable-next-line:no-output-on-prefix
        this.onSignOut = new EventEmitter();
    }
    ngOnInit() {
        this.user$ = this.afa.user;
        this.user$.subscribe((user) => {
            this.user = user;
            this.displayNameInitials = user ? this.getDisplayNameInitials(user.displayName) : null;
        });
    }
    getDisplayNameInitials(displayName) {
        if (!displayName) {
            return null;
        }
        const initialsRegExp = displayName.match(/\b\w/g) || [];
        const initials = ((initialsRegExp.shift() || '') + (initialsRegExp.pop() || '')).toUpperCase();
        return initials;
    }
    openProfile() {
        const dialogRef = this.dialog.open(UserComponent);
        const instance = dialogRef.componentInstance;
        instance.canDeleteAccount = this.canDeleteAccount;
        instance.canEditAccount = this.canEditAccount;
    }
    signOut() {
        return __awaiter(this, void 0, void 0, function* () {
            try {
                yield this.afa.signOut();
                // Sign-out successful.
                this.onSignOut.emit();
            }
            catch (e) {
                // An error happened.
                console.error('An error happened while signing out!', e);
            }
        });
    }
};
NgxAuthFirebaseuiAvatarComponent.ctorParameters = () => [
    { type: AngularFireAuth },
    { type: MatDialog }
];
__decorate([
    Input()
], NgxAuthFirebaseuiAvatarComponent.prototype, "layout", void 0);
__decorate([
    Input()
], NgxAuthFirebaseuiAvatarComponent.prototype, "canLogout", void 0);
__decorate([
    Input()
], NgxAuthFirebaseuiAvatarComponent.prototype, "links", void 0);
__decorate([
    Input()
], NgxAuthFirebaseuiAvatarComponent.prototype, "canViewAccount", void 0);
__decorate([
    Input()
], NgxAuthFirebaseuiAvatarComponent.prototype, "canDeleteAccount", void 0);
__decorate([
    Input()
], NgxAuthFirebaseuiAvatarComponent.prototype, "canEditAccount", void 0);
__decorate([
    Input()
], NgxAuthFirebaseuiAvatarComponent.prototype, "textProfile", void 0);
__decorate([
    Input()
], NgxAuthFirebaseuiAvatarComponent.prototype, "textSignOut", void 0);
__decorate([
    Output()
], NgxAuthFirebaseuiAvatarComponent.prototype, "onSignOut", void 0);
NgxAuthFirebaseuiAvatarComponent = __decorate([
    Component({
        selector: 'ngx-auth-firebaseui-avatar',
        template: "<button *ngIf=\"user\"\n        class=\"ngx-auth-firebaseui-avatar-button\"\n        [matMenuTriggerFor]=\"posXMenu\"\n        [matTooltip]=\"user?.displayName\"\n        [style.background-image]=\"'url(' + user?.photoURL + ')'\"\n        aria-label=\"Open x-positioned menu\"\n        mat-mini-fab\n        style=\"background-size: cover\">\n  <span *ngIf=\"!user?.photoURL\">{{displayNameInitials || ''}}</span>\n</button>\n\n<mat-menu #posXMenu=\"matMenu\" class=\"before ngx-auth-firebaseui-avatar-menu\" xPosition=\"before\" >\n  <div fxLayout=\"row\" fxLayout.xs=\"column\" style=\"padding-left: 10px; padding-right: 10px\" [ngStyle]=\"{ 'padding-top.px': layout === 'default' ? 0 : 10 }\">\n    <button [style.background-image]=\"'url(' + user?.photoURL + ')'\"\n            mat-fab\n            style=\"background-size: cover\"\n            *ngIf=\"layout === 'default'\">\n      <span *ngIf=\"!user?.photoURL\">{{displayNameInitials || ''}}</span>\n    </button>\n    <div fxLayout=\"column\" style=\"padding-left: 10px; padding-right: 10px\">\n      <strong mat-card-title>{{user?.displayName}}</strong>\n      <em mat-card-subtitle style=\"font-style: italic\">{{user?.email}}</em>\n    </div>\n  </div>\n\n  <div fxFlex=\"100\" fxLayout=\"column\" [ngStyle]=\"{ 'padding-bottom.px': layout === 'default' ? 0 : 10 } \">\n    <div *ngFor=\"let menuItem of links\" class=\"links-menu\">\n      <button (click)=\"menuItem?.callback()\" mat-menu-item>\n        <mat-icon>{{menuItem?.icon}}</mat-icon>\n        {{menuItem?.text}}</button>\n    </div>\n    <button *ngIf=\"canViewAccount\" (click)=\"openProfile()\" color=\"primary\" fxLayoutAlign=\"center\" mat-raised-button>{{ textProfile }}\n    </button>\n    <button (click)=\"signOut()\" *ngIf=\"canLogout\" color=\"warn\" fxLayoutAlign=\"center\" mat-raised-button>{{ textSignOut }}\n    </button>\n  </div>\n</mat-menu>\n",
        styles: [".mat-raised-button{margin:.2rem 1rem}.links-menu{text-align:center}"]
    })
], NgxAuthFirebaseuiAvatarComponent);
export { NgxAuthFirebaseuiAvatarComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LWF1dGgtZmlyZWJhc2V1aS1hdmF0YXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LWF1dGgtZmlyZWJhc2V1aS8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL25neC1hdXRoLWZpcmViYXNldWktYXZhdGFyL25neC1hdXRoLWZpcmViYXNldWktYXZhdGFyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFDLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFVLE1BQU0sRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUM3RSxPQUFPLEVBQUMsZUFBZSxFQUFDLE1BQU0sb0JBQW9CLENBQUM7QUFHbkQsT0FBTyxFQUFDLFNBQVMsRUFBQyxNQUFNLDBCQUEwQixDQUFDO0FBQ25ELE9BQU8sRUFBQyxhQUFhLEVBQUMsTUFBTSxJQUFJLENBQUM7QUFjakMsSUFBYSxnQ0FBZ0MsR0FBN0MsTUFBYSxnQ0FBZ0M7SUFrQzNDLFlBQW1CLEdBQW9CLEVBQ3BCLE1BQWlCO1FBRGpCLFFBQUcsR0FBSCxHQUFHLENBQWlCO1FBQ3BCLFdBQU0sR0FBTixNQUFNLENBQVc7UUFoQ3BDLFdBQU0sR0FBeUIsU0FBUyxDQUFDO1FBR3pDLGNBQVMsR0FBRyxJQUFJLENBQUM7UUFNakIsbUJBQWMsR0FBRyxJQUFJLENBQUM7UUFHdEIscUJBQWdCLEdBQUcsSUFBSSxDQUFDO1FBR3hCLG1CQUFjLEdBQUcsSUFBSSxDQUFDO1FBR3RCLGdCQUFXLEdBQUcsU0FBUyxDQUFDO1FBR3hCLGdCQUFXLEdBQUcsVUFBVSxDQUFDO1FBRXpCLCtDQUErQztRQUUvQyxjQUFTLEdBQXVCLElBQUksWUFBWSxFQUFFLENBQUM7SUFRbkQsQ0FBQztJQUVELFFBQVE7UUFDTixJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDO1FBQzNCLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUMsSUFBVSxFQUFFLEVBQUU7WUFDbEMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7WUFDakIsSUFBSSxDQUFDLG1CQUFtQixHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLHNCQUFzQixDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO1FBQ3pGLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELHNCQUFzQixDQUFDLFdBQTBCO1FBQy9DLElBQUksQ0FBQyxXQUFXLEVBQUU7WUFDaEIsT0FBTyxJQUFJLENBQUM7U0FDYjtRQUNELE1BQU0sY0FBYyxHQUFxQixXQUFXLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUMxRSxNQUFNLFFBQVEsR0FBRyxDQUFDLENBQUMsY0FBYyxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQyxHQUFHLENBQUMsY0FBYyxDQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDL0YsT0FBTyxRQUFRLENBQUM7SUFDbEIsQ0FBQztJQUVELFdBQVc7UUFDVCxNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUNsRCxNQUFNLFFBQVEsR0FBRyxTQUFTLENBQUMsaUJBQWlCLENBQUM7UUFDN0MsUUFBUSxDQUFDLGdCQUFnQixHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQztRQUNsRCxRQUFRLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUM7SUFDaEQsQ0FBQztJQUVLLE9BQU87O1lBQ1gsSUFBSTtnQkFDRixNQUFNLElBQUksQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLENBQUM7Z0JBQ3pCLHVCQUF1QjtnQkFDdkIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsQ0FBQzthQUN2QjtZQUFDLE9BQU8sQ0FBQyxFQUFFO2dCQUNWLHFCQUFxQjtnQkFDckIsT0FBTyxDQUFDLEtBQUssQ0FBQyxzQ0FBc0MsRUFBRSxDQUFDLENBQUMsQ0FBQzthQUMxRDtRQUNILENBQUM7S0FBQTtDQUNGLENBQUE7O1lBdEN5QixlQUFlO1lBQ1osU0FBUzs7QUFoQ3BDO0lBREMsS0FBSyxFQUFFO2dFQUNpQztBQUd6QztJQURDLEtBQUssRUFBRTttRUFDUztBQUdqQjtJQURDLEtBQUssRUFBRTsrREFDYztBQUd0QjtJQURDLEtBQUssRUFBRTt3RUFDYztBQUd0QjtJQURDLEtBQUssRUFBRTswRUFDZ0I7QUFHeEI7SUFEQyxLQUFLLEVBQUU7d0VBQ2M7QUFHdEI7SUFEQyxLQUFLLEVBQUU7cUVBQ2dCO0FBR3hCO0lBREMsS0FBSyxFQUFFO3FFQUNpQjtBQUl6QjtJQURDLE1BQU0sRUFBRTttRUFDMEM7QUE1QnhDLGdDQUFnQztJQUw1QyxTQUFTLENBQUM7UUFDVCxRQUFRLEVBQUUsNEJBQTRCO1FBQ3RDLHkyREFBMEQ7O0tBRTNELENBQUM7R0FDVyxnQ0FBZ0MsQ0F3RTVDO1NBeEVZLGdDQUFnQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Q29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIElucHV0LCBPbkluaXQsIE91dHB1dH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge0FuZ3VsYXJGaXJlQXV0aH0gZnJvbSAnQGFuZ3VsYXIvZmlyZS9hdXRoJztcbmltcG9ydCB7VXNlcn0gZnJvbSAnZmlyZWJhc2UnO1xuaW1wb3J0IHtPYnNlcnZhYmxlfSBmcm9tICdyeGpzJztcbmltcG9ydCB7TWF0RGlhbG9nfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9kaWFsb2cnO1xuaW1wb3J0IHtVc2VyQ29tcG9uZW50fSBmcm9tICcuLic7XG5cbmV4cG9ydCBpbnRlcmZhY2UgTGlua01lbnVJdGVtIHtcbiAgdGV4dDogc3RyaW5nO1xuICBpY29uPzogc3RyaW5nO1xuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6YmFuLXR5cGVzXG4gIGNhbGxiYWNrPzogRnVuY3Rpb247XG59XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ25neC1hdXRoLWZpcmViYXNldWktYXZhdGFyJyxcbiAgdGVtcGxhdGVVcmw6ICcuL25neC1hdXRoLWZpcmViYXNldWktYXZhdGFyLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vbmd4LWF1dGgtZmlyZWJhc2V1aS1hdmF0YXIuY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBOZ3hBdXRoRmlyZWJhc2V1aUF2YXRhckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG5cbiAgQElucHV0KClcbiAgbGF5b3V0OiAnZGVmYXVsdCcgfCAnc2ltcGxlJyA9ICdkZWZhdWx0JztcblxuICBASW5wdXQoKVxuICBjYW5Mb2dvdXQgPSB0cnVlO1xuXG4gIEBJbnB1dCgpXG4gIGxpbmtzOiBMaW5rTWVudUl0ZW1bXTtcblxuICBASW5wdXQoKVxuICBjYW5WaWV3QWNjb3VudCA9IHRydWU7XG5cbiAgQElucHV0KClcbiAgY2FuRGVsZXRlQWNjb3VudCA9IHRydWU7XG5cbiAgQElucHV0KClcbiAgY2FuRWRpdEFjY291bnQgPSB0cnVlO1xuXG4gIEBJbnB1dCgpXG4gIHRleHRQcm9maWxlID0gJ1Byb2ZpbGUnO1xuXG4gIEBJbnB1dCgpXG4gIHRleHRTaWduT3V0ID0gJ1NpZ24gT3V0JztcblxuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tb3V0cHV0LW9uLXByZWZpeFxuICBAT3V0cHV0KClcbiAgb25TaWduT3V0OiBFdmVudEVtaXR0ZXI8dm9pZD4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgdXNlcjogVXNlcjtcbiAgdXNlciQ6IE9ic2VydmFibGU8VXNlciB8IG51bGw+O1xuICBkaXNwbGF5TmFtZUluaXRpYWxzOiBzdHJpbmcgfCBudWxsO1xuXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBhZmE6IEFuZ3VsYXJGaXJlQXV0aCxcbiAgICAgICAgICAgICAgcHVibGljIGRpYWxvZzogTWF0RGlhbG9nKSB7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLnVzZXIkID0gdGhpcy5hZmEudXNlcjtcbiAgICB0aGlzLnVzZXIkLnN1YnNjcmliZSgodXNlcjogVXNlcikgPT4ge1xuICAgICAgdGhpcy51c2VyID0gdXNlcjtcbiAgICAgIHRoaXMuZGlzcGxheU5hbWVJbml0aWFscyA9IHVzZXIgPyB0aGlzLmdldERpc3BsYXlOYW1lSW5pdGlhbHModXNlci5kaXNwbGF5TmFtZSkgOiBudWxsO1xuICAgIH0pO1xuICB9XG5cbiAgZ2V0RGlzcGxheU5hbWVJbml0aWFscyhkaXNwbGF5TmFtZTogc3RyaW5nIHwgbnVsbCk6IHN0cmluZyB8IG51bGwge1xuICAgIGlmICghZGlzcGxheU5hbWUpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBpbml0aWFsc1JlZ0V4cDogUmVnRXhwTWF0Y2hBcnJheSA9IGRpc3BsYXlOYW1lLm1hdGNoKC9cXGJcXHcvZykgfHwgW107XG4gICAgY29uc3QgaW5pdGlhbHMgPSAoKGluaXRpYWxzUmVnRXhwLnNoaWZ0KCkgfHwgJycpICsgKGluaXRpYWxzUmVnRXhwLnBvcCgpIHx8ICcnKSkudG9VcHBlckNhc2UoKTtcbiAgICByZXR1cm4gaW5pdGlhbHM7XG4gIH1cblxuICBvcGVuUHJvZmlsZSgpIHtcbiAgICBjb25zdCBkaWFsb2dSZWYgPSB0aGlzLmRpYWxvZy5vcGVuKFVzZXJDb21wb25lbnQpO1xuICAgIGNvbnN0IGluc3RhbmNlID0gZGlhbG9nUmVmLmNvbXBvbmVudEluc3RhbmNlO1xuICAgIGluc3RhbmNlLmNhbkRlbGV0ZUFjY291bnQgPSB0aGlzLmNhbkRlbGV0ZUFjY291bnQ7XG4gICAgaW5zdGFuY2UuY2FuRWRpdEFjY291bnQgPSB0aGlzLmNhbkVkaXRBY2NvdW50O1xuICB9XG5cbiAgYXN5bmMgc2lnbk91dCgpIHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5hZmEuc2lnbk91dCgpO1xuICAgICAgLy8gU2lnbi1vdXQgc3VjY2Vzc2Z1bC5cbiAgICAgIHRoaXMub25TaWduT3V0LmVtaXQoKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAvLyBBbiBlcnJvciBoYXBwZW5lZC5cbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0FuIGVycm9yIGhhcHBlbmVkIHdoaWxlIHNpZ25pbmcgb3V0IScsIGUpO1xuICAgIH1cbiAgfVxufVxuIl19
import { __awaiter, __decorate, __generator, __param } from "tslib";
import { EventEmitter, forwardRef, Inject, Injectable } from '@angular/core';
import { AngularFireAuth } from '@angular/fire/auth';
import { firebase } from '@firebase/app';
import '@firebase/auth';
import { BehaviorSubject } from 'rxjs';
import { map, take } from 'rxjs/operators';
import { Accounts } from '../enums';
import { FirestoreSyncService } from './firestore-sync.service';
import { MAT_SNACK_BAR_DEFAULT_OPTIONS, MatSnackBar, MatSnackBarConfig } from '@angular/material/snack-bar';
import { NgxAuthFirebaseUIConfigToken } from '../tokens';
import * as i0 from "@angular/core";
import * as i1 from "@angular/fire/auth";
import * as i2 from "../tokens/index";
import * as i3 from "@angular/material/snack-bar";
import * as i4 from "./firestore-sync.service";
export var facebookAuthProvider = new firebase.auth.FacebookAuthProvider();
export var googleAuthProvider = new firebase.auth.GoogleAuthProvider();
export var appleAuthProvider = new firebase.auth.OAuthProvider('apple.com');
export var twitterAuthProvider = new firebase.auth.TwitterAuthProvider();
export var githubAuthProvider = new firebase.auth.GithubAuthProvider();
export var microsoftAuthProvider = new firebase.auth.OAuthProvider('microsoft.com');
export var yahooAuthProvider = new firebase.auth.OAuthProvider('yahoo.com');
export var AuthProvider;
(function (AuthProvider) {
    AuthProvider["ALL"] = "all";
    AuthProvider["ANONYMOUS"] = "anonymous";
    AuthProvider["EmailAndPassword"] = "firebase";
    AuthProvider["Google"] = "google";
    AuthProvider["Apple"] = "apple";
    AuthProvider["Facebook"] = "facebook";
    AuthProvider["Twitter"] = "twitter";
    AuthProvider["Github"] = "github";
    AuthProvider["Microsoft"] = "microsoft";
    AuthProvider["Yahoo"] = "yahoo";
    AuthProvider["PhoneNumber"] = "phoneNumber";
})(AuthProvider || (AuthProvider = {}));
var AuthProcessService = /** @class */ (function () {
    function AuthProcessService(afa, config, snackBar, fireStoreService, matSnackBarConfig) {
        this.afa = afa;
        this.config = config;
        this.snackBar = snackBar;
        this.fireStoreService = fireStoreService;
        this.matSnackBarConfig = matSnackBarConfig;
        this.onSuccessEmitter = new EventEmitter();
        this.onErrorEmitter = new EventEmitter();
        // Useful to know about auth state even between reloads.
        // Replace emailConfirmationSent and emailToConfirm.
        this._user$ = new BehaviorSubject(null);
    }
    Object.defineProperty(AuthProcessService.prototype, "user$", {
        get: function () {
            return this._user$.asObservable();
        },
        enumerable: true,
        configurable: true
    });
    AuthProcessService.prototype.listenToUserEvents = function () {
        var _this = this;
        this.afa.user.subscribe(function (user) {
            _this._user$.next(user);
            _this.user = user;
        });
    };
    /**
     * Reset the password of the ngx-auth-firebaseui-user via email
     *
     * @param email - the email to reset
     */
    AuthProcessService.prototype.resetPassword = function (email) {
        return __awaiter(this, void 0, void 0, function () {
            var error_1;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 2, , 3]);
                        console.log('Password reset email sent');
                        return [4 /*yield*/, this.afa.sendPasswordResetEmail(email)];
                    case 1: return [2 /*return*/, _a.sent()];
                    case 2:
                        error_1 = _a.sent();
                        return [2 /*return*/, this.notifyError(error_1)];
                    case 3: return [2 /*return*/];
                }
            });
        });
    };
    /**
     * General sign in mechanism to authenticate the users with a firebase project
     * using a traditional way, via username and password or by using an authentication provider
     * like google, facebook, twitter and github
     *
     * @param provider - the provider to authenticate with (google, facebook, twitter, github)
     * @param credentials optional email and password
     */
    AuthProcessService.prototype.signInWith = function (provider, credentials) {
        return __awaiter(this, void 0, void 0, function () {
            var signInResult, _a, err_1;
            return __generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        _b.trys.push([0, 23, , 24]);
                        signInResult = void 0;
                        _a = provider;
                        switch (_a) {
                            case AuthProvider.ANONYMOUS: return [3 /*break*/, 1];
                            case AuthProvider.EmailAndPassword: return [3 /*break*/, 3];
                            case AuthProvider.Google: return [3 /*break*/, 5];
                            case AuthProvider.Apple: return [3 /*break*/, 7];
                            case AuthProvider.Facebook: return [3 /*break*/, 9];
                            case AuthProvider.Twitter: return [3 /*break*/, 11];
                            case AuthProvider.Github: return [3 /*break*/, 13];
                            case AuthProvider.Microsoft: return [3 /*break*/, 15];
                            case AuthProvider.Yahoo: return [3 /*break*/, 17];
                            case AuthProvider.PhoneNumber: return [3 /*break*/, 19];
                        }
                        return [3 /*break*/, 20];
                    case 1: return [4 /*yield*/, this.afa.signInAnonymously()];
                    case 2:
                        signInResult = (_b.sent());
                        return [3 /*break*/, 21];
                    case 3: return [4 /*yield*/, this.afa.signInWithEmailAndPassword(credentials.email, credentials.password)];
                    case 4:
                        signInResult = (_b.sent());
                        return [3 /*break*/, 21];
                    case 5: return [4 /*yield*/, this.afa.signInWithPopup(googleAuthProvider)];
                    case 6:
                        signInResult = (_b.sent());
                        return [3 /*break*/, 21];
                    case 7: return [4 /*yield*/, this.afa.signInWithPopup(appleAuthProvider)];
                    case 8:
                        signInResult = (_b.sent());
                        return [3 /*break*/, 21];
                    case 9: return [4 /*yield*/, this.afa.signInWithPopup(facebookAuthProvider)];
                    case 10:
                        signInResult = (_b.sent());
                        return [3 /*break*/, 21];
                    case 11: return [4 /*yield*/, this.afa.signInWithPopup(twitterAuthProvider)];
                    case 12:
                        signInResult = (_b.sent());
                        return [3 /*break*/, 21];
                    case 13: return [4 /*yield*/, this.afa.signInWithPopup(githubAuthProvider)];
                    case 14:
                        signInResult = (_b.sent());
                        return [3 /*break*/, 21];
                    case 15: return [4 /*yield*/, this.afa.signInWithPopup(microsoftAuthProvider)];
                    case 16:
                        signInResult = (_b.sent());
                        return [3 /*break*/, 21];
                    case 17: return [4 /*yield*/, this.afa.signInWithPopup(yahooAuthProvider)];
                    case 18:
                        signInResult = (_b.sent());
                        return [3 /*break*/, 21];
                    case 19: 
                    // coming soon - see feature/sms branch
                    return [3 /*break*/, 21];
                    case 20: throw new Error(AuthProvider[provider] + " is not available as auth provider");
                    case 21: return [4 /*yield*/, this.handleSuccess(signInResult)];
                    case 22:
                        _b.sent();
                        return [3 /*break*/, 24];
                    case 23:
                        err_1 = _b.sent();
                        this.handleError(err_1);
                        return [3 /*break*/, 24];
                    case 24: return [2 /*return*/];
                }
            });
        });
    };
    /**
     * Sign up new users via email and password.
     * After that the ngx-auth-firebaseui-user should verify and confirm an email sent via the firebase
     *
     * @param displayName - the displayName if the new ngx-auth-firebaseui-user
     * @param credentials email and password
     * @returns -
     */
    AuthProcessService.prototype.signUp = function (displayName, credentials) {
        return __awaiter(this, void 0, void 0, function () {
            var userCredential, user, err_2;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 8, , 9]);
                        return [4 /*yield*/, this.afa.createUserWithEmailAndPassword(credentials.email, credentials.password)];
                    case 1:
                        userCredential = _a.sent();
                        user = userCredential.user;
                        return [4 /*yield*/, this.updateProfile(displayName, user.photoURL)];
                    case 2:
                        _a.sent();
                        if (!this.config.enableFirestoreSync) return [3 /*break*/, 4];
                        return [4 /*yield*/, this.fireStoreService
                                .getUserDocRefByUID(user.uid)
                                .set({
                                uid: user.uid,
                                displayName: displayName,
                                email: user.email,
                                photoURL: user.photoURL
                            })];
                    case 3:
                        _a.sent();
                        _a.label = 4;
                    case 4:
                        if (!this.config.enableEmailVerification) return [3 /*break*/, 6];
                        return [4 /*yield*/, user.sendEmailVerification()];
                    case 5:
                        _a.sent();
                        _a.label = 6;
                    case 6:
                        // Legacy fields
                        this.emailConfirmationSent = true;
                        this.emailToConfirm = credentials.email;
                        return [4 /*yield*/, this.handleSuccess(userCredential)];
                    case 7:
                        _a.sent();
                        return [3 /*break*/, 9];
                    case 8:
                        err_2 = _a.sent();
                        this.handleError(err_2);
                        return [3 /*break*/, 9];
                    case 9: return [2 /*return*/];
                }
            });
        });
    };
    AuthProcessService.prototype.sendNewVerificationEmail = function () {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                if (!this.user) {
                    return [2 /*return*/, Promise.reject(new Error('No signed in user'))];
                }
                return [2 /*return*/, this.user.sendEmailVerification()];
            });
        });
    };
    AuthProcessService.prototype.signOut = function () {
        return __awaiter(this, void 0, void 0, function () {
            var error_2;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 2, , 3]);
                        return [4 /*yield*/, this.afa.signOut()];
                    case 1:
                        _a.sent();
                        return [3 /*break*/, 3];
                    case 2:
                        error_2 = _a.sent();
                        this.notifyError(error_2);
                        return [3 /*break*/, 3];
                    case 3: return [2 /*return*/];
                }
            });
        });
    };
    /**
     * Update the profile (name + photo url) of the authenticated ngx-auth-firebaseui-user in the
     * firebase authentication feature (not in firestore)
     *
     * @param name - the new name of the authenticated ngx-auth-firebaseui-user
     * @param photoURL - the new photo url of the authenticated ngx-auth-firebaseui-user
     * @returns -
     */
    AuthProcessService.prototype.updateProfile = function (name, photoURL) {
        return this.afa.currentUser.then(function (user) {
            if (!photoURL) {
                return user.updateProfile({ displayName: name });
            }
            else {
                return user.updateProfile({ displayName: name, photoURL: photoURL });
            }
        });
    };
    AuthProcessService.prototype.parseUserInfo = function (user) {
        return {
            uid: user.uid,
            displayName: user.displayName,
            email: user.email,
            phoneNumber: user.phoneNumber,
            photoURL: user.photoURL,
            providerId: user.providerData.length > 0 ? user.providerData[0].providerId : null
        };
    };
    AuthProcessService.prototype.getUserPhotoUrl = function () {
        var _this = this;
        return this._user$.pipe(map(function (user) {
            if (!user) {
                return null;
            }
            else if (user.photoURL) {
                return user.photoURL;
            }
            else if (user.emailVerified) {
                return _this.getPhotoPath(Accounts.CHECK);
            }
            else if (user.isAnonymous) {
                return _this.getPhotoPath(Accounts.OFF);
            }
            else {
                return _this.getPhotoPath(Accounts.NONE);
            }
        }));
    };
    AuthProcessService.prototype.getPhotoPath = function (image) {
        return "assets/user/" + image + ".svg";
    };
    AuthProcessService.prototype.signInWithPhoneNumber = function () {
        // todo: 3.1.18
    };
    AuthProcessService.prototype.handleSuccess = function (userCredential) {
        return __awaiter(this, void 0, void 0, function () {
            var e_1, fallbackMessage;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        this.onSuccessEmitter.next(userCredential.user);
                        if (!this.config.enableFirestoreSync) return [3 /*break*/, 4];
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 3, , 4]);
                        return [4 /*yield*/, this.fireStoreService.updateUserData(this.parseUserInfo(userCredential.user))];
                    case 2:
                        _a.sent();
                        return [3 /*break*/, 4];
                    case 3:
                        e_1 = _a.sent();
                        console.error("Error occurred while updating user data with firestore: " + e_1);
                        return [3 /*break*/, 4];
                    case 4:
                        if (this.config.toastMessageOnAuthSuccess) {
                            fallbackMessage = "Hello " + (userCredential.user.displayName ? userCredential.user.displayName : '') + "!";
                            this.showToast(this.messageOnAuthSuccess || fallbackMessage);
                        }
                        return [2 /*return*/];
                }
            });
        });
    };
    AuthProcessService.prototype.handleError = function (error) {
        this.notifyError(error);
        console.error(error);
    };
    // Refresh user info. Can be useful for instance to get latest status regarding email verification.
    AuthProcessService.prototype.reloadUserInfo = function () {
        return this._user$.pipe(take(1)).subscribe(function (user) { return user && user.reload(); });
    };
    // Search for an error message.
    // Consumers of this library are given the possibility to provide a
    // function in case they want to instrument message based on error properties.
    AuthProcessService.prototype.getMessageOnAuthError = function (error) {
        // tslint:disable-next-line:no-bitwise
        return error.toString() || 'Sorry, something went wrong. Please retry later.';
    };
    // Show a toast using current snackbar config. If message is empty, no toast is displayed allowing to opt-out when needed.
    // Default MatSnackBarConfig has no duration, meaning it stays visible forever.
    // If that's the case, an action button is added to allow the end-user to dismiss the toast.
    AuthProcessService.prototype.showToast = function (message) {
        if (message) {
            this.snackBar.open(message, this.matSnackBarConfig.duration ? null : 'OK');
        }
    };
    AuthProcessService.prototype.showErrorToast = function (error) {
        if (this.config.toastMessageOnAuthError) {
            this.showToast(this.getMessageOnAuthError(error));
        }
    };
    AuthProcessService.prototype.notifyError = function (error) {
        this.onErrorEmitter.emit(error);
        this.showErrorToast(error);
    };
    AuthProcessService.ctorParameters = function () { return [
        { type: AngularFireAuth },
        { type: undefined, decorators: [{ type: Inject, args: [forwardRef(function () { return NgxAuthFirebaseUIConfigToken; }),] }] },
        { type: MatSnackBar },
        { type: FirestoreSyncService },
        { type: MatSnackBarConfig, decorators: [{ type: Inject, args: [MAT_SNACK_BAR_DEFAULT_OPTIONS,] }] }
    ]; };
    AuthProcessService.ɵprov = i0.ɵɵdefineInjectable({ factory: function AuthProcessService_Factory() { return new AuthProcessService(i0.ɵɵinject(i1.AngularFireAuth), i0.ɵɵinject(i2.NgxAuthFirebaseUIConfigToken), i0.ɵɵinject(i3.MatSnackBar), i0.ɵɵinject(i4.FirestoreSyncService), i0.ɵɵinject(i3.MAT_SNACK_BAR_DEFAULT_OPTIONS)); }, token: AuthProcessService, providedIn: "root" });
    AuthProcessService = __decorate([
        Injectable({
            providedIn: 'root'
        }),
        __param(1, Inject(forwardRef(function () { return NgxAuthFirebaseUIConfigToken; }))),
        __param(4, Inject(MAT_SNACK_BAR_DEFAULT_OPTIONS))
    ], AuthProcessService);
    return AuthProcessService;
}());
export { AuthProcessService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0aC1wcm9jZXNzLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZ3gtYXV0aC1maXJlYmFzZXVpLyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL2F1dGgtcHJvY2Vzcy5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsWUFBWSxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzdFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUNyRCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3pDLE9BQU8sZ0JBQWdCLENBQUM7QUFFeEIsT0FBTyxFQUFFLGVBQWUsRUFBYyxNQUFNLE1BQU0sQ0FBQztBQUNuRCxPQUFPLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFDcEMsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDaEUsT0FBTyxFQUFFLDZCQUE2QixFQUFFLFdBQVcsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBRTVHLE9BQU8sRUFBRSw0QkFBNEIsRUFBRSxNQUFNLFdBQVcsQ0FBQzs7Ozs7O0FBR3pELE1BQU0sQ0FBQyxJQUFNLG9CQUFvQixHQUFHLElBQUksUUFBUSxDQUFDLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxDQUFDO0FBQzdFLE1BQU0sQ0FBQyxJQUFNLGtCQUFrQixHQUFHLElBQUksUUFBUSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO0FBQ3pFLE1BQU0sQ0FBQyxJQUFNLGlCQUFpQixHQUFHLElBQUksUUFBUSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLENBQUM7QUFDOUUsTUFBTSxDQUFDLElBQU0sbUJBQW1CLEdBQUcs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Qzs7Z0JBM1BhLGVBQWU7Z0RBQzFCLE1BQU0sU0FBQyxVQUFVLENBQUMsY0FBTSxPQUFBLDRCQUE0QixFQUE1QixDQUE0QixDQUFDO2dCQUNwQyxXQUFXO2dCQUNILG9CQUFvQjtnQkFDb0IsaUJBQWlCLHVCQUFsRixNQUFNLFNBQUMsNkJBQTZCOzs7SUE5QjVCLGtCQUFrQjtRQUg5QixVQUFVLENBQUM7WUFDVixVQUFVLEVBQUUsTUFBTTtTQUNuQixDQUFDO1FBNEJHLFdBQUEsTUFBTSxDQUFDLFVBQVUsQ0FBQyxjQUFNLE9BQUEsNEJBQTRCLEVBQTVCLENBQTRCLENBQUMsQ0FBQyxDQUFBO1FBR3RELFdBQUEsTUFBTSxDQUFDLDZCQUE2QixDQUFDLENBQUE7T0E5QjdCLGtCQUFrQixDQXVSOUI7NkJBOVREO0NBOFRDLEFBdlJELElBdVJDO1NBdlJZLGtCQUFrQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEV2ZW50RW1pdHRlciwgZm9yd2FyZFJlZiwgSW5qZWN0LCBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBBbmd1bGFyRmlyZUF1dGggfSBmcm9tICdAYW5ndWxhci9maXJlL2F1dGgnO1xuaW1wb3J0IHsgZmlyZWJhc2UgfSBmcm9tICdAZmlyZWJhc2UvYXBwJztcbmltcG9ydCAnQGZpcmViYXNlL2F1dGgnO1xuaW1wb3J0IHsgVXNlciwgVXNlckluZm8gfSBmcm9tICdmaXJlYmFzZS9hcHAnO1xuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0LCBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBtYXAsIHRha2UgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBBY2NvdW50cyB9IGZyb20gJy4uL2VudW1zJztcbmltcG9ydCB7IEZpcmVzdG9yZVN5bmNTZXJ2aWNlIH0gZnJvbSAnLi9maXJlc3RvcmUtc3luYy5zZXJ2aWNlJztcbmltcG9ydCB7IE1BVF9TTkFDS19CQVJfREVGQVVMVF9PUFRJT05TLCBNYXRTbmFja0JhciwgTWF0U25hY2tCYXJDb25maWcgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9zbmFjay1iYXInO1xuaW1wb3J0IHsgSUNyZWRlbnRpYWxzLCBJU2lnbkluUHJvY2VzcywgSVNpZ25VcFByb2Nlc3MsIE5neEF1dGhGaXJlYmFzZVVJQ29uZmlnIH0gZnJvbSAnLi4vaW50ZXJmYWNlcyc7XG5pbXBvcnQgeyBOZ3hBdXRoRmlyZWJhc2VVSUNvbmZpZ1Rva2VuIH0gZnJvbSAnLi4vdG9rZW5zJztcbmltcG9ydCBVc2VyQ3JlZGVudGlhbCA9IGZpcmViYXNlLmF1dGguVXNlckNyZWRlbnRpYWw7XG5cbmV4cG9ydCBjb25zdCBmYWNlYm9va0F1dGhQcm92aWRlciA9IG5ldyBmaXJlYmFzZS5hdXRoLkZhY2Vib29rQXV0aFByb3ZpZGVyKCk7XG5leHBvcnQgY29uc3QgZ29vZ2xlQXV0aFByb3ZpZGVyID0gbmV3IGZpcmViYXNlLmF1dGguR29vZ2xlQXV0aFByb3ZpZGVyKCk7XG5leHBvcnQgY29uc3QgYXBwbGVBdXRoUHJvdmlkZXIgPSBuZXcgZmlyZWJhc2UuYXV0aC5PQXV0aFByb3ZpZGVyKCdhcHBsZS5jb20nKTtcbmV4cG9ydCBjb25zdCB0d2l0dGVyQXV0aFByb3ZpZGVyID0gbmV3IGZpcmViYXNlLmF1dGguVHdpdHRlckF1dGhQcm92aWRlcigpO1xuZXhwb3J0IGNvbnN0IGdpdGh1YkF1dGhQcm92aWRlciA9IG5ldyBmaXJlYmFzZS5hdXRoLkdpdGh1YkF1dGhQcm92aWRlcigpO1xuZXhwb3J0IGNvbnN0IG1pY3Jvc29mdEF1dGhQcm92aWRlciA9IG5ldyBmaXJlYmFzZS5hdXRoLk9BdXRoUHJvdmlkZXIoJ21pY3Jvc29mdC5jb20nKTtcbmV4cG9ydCBjb25zdCB5YWhvb0F1dGhQcm92aWRlciA9IG5ldyBmaXJlYmFzZS5hdXRoLk9BdXRoUHJvdmlkZXIoJ3lhaG9vLmNvbScpO1xuXG5leHBvcnQgZW51bSBBdXRoUHJvdmlkZXIge1xuICBBTEwgPSAnYWxsJyxcbiAgQU5PTllNT1VTID0gJ2Fub255bW91cycsXG4gIEVtYWlsQW5kUGFzc3dvcmQgPSAnZmlyZWJhc2UnLFxuICBHb29nbGUgPSAnZ29vZ2xlJyxcbiAgQXBwbGUgPSAnYXBwbGUnLFxuICBGYWNlYm9vayA9ICdmYWNlYm9vaycsXG4gIFR3aXR0ZXIgPSAndHdpdHRlcicsXG4gIEdpdGh1YiA9ICdnaXRodWInLFxuICBNaWNyb3NvZnQgPSAnbWljcm9zb2Z0JyxcbiAgWWFob28gPSAneWFob28nLFxuICBQaG9uZU51bWJlciA9ICdwaG9uZU51bWJlcidcbn1cblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgQXV0aFByb2Nlc3NTZXJ2aWNlIGltcGxlbWVudHMgSVNpZ25JblByb2Nlc3MsIElTaWduVXBQcm9jZXNzIHtcbiAgb25TdWNjZXNzRW1pdHRlcjogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgb25FcnJvckVtaXR0ZXI6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgLy8gVXNlZnVsIHRvIGtub3cgYWJvdXQgYXV0aCBzdGF0ZSBldmVuIGJldHdlZW4gcmVsb2Fkcy5cbiAgLy8gUmVwbGFjZSBlbWFpbENvbmZpcm1hdGlvblNlbnQgYW5kIGVtYWlsVG9Db25maXJtLlxuICBwcml2YXRlIF91c2VyJCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8ZmlyZWJhc2UuVXNlciB8IG51bGw+KG51bGwpO1xuICBnZXQgdXNlciQoKTogT2JzZXJ2YWJsZTxmaXJlYmFzZS5Vc2VyIHwgbnVsbD4ge1xuICAgIHJldHVybiB0aGlzLl91c2VyJC5hc09ic2VydmFibGUoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAZGVwcmVjYXRlZCBhY2Nlc3MgdmlhIHVzZXIkIGFzeW5jaHJvbm91c2x5IGluc3RlYWRcbiAgICovXG4gIHVzZXI6IFVzZXI7XG5cbiAgbWVzc2FnZU9uQXV0aFN1Y2Nlc3M6IHN0cmluZztcbiAgbWVzc2FnZU9uQXV0aEVycm9yOiBzdHJpbmc7XG5cbiAgLy8gTGVnYWN5IGZpZWxkIHRoYXQgaXMgc2V0IHRvIHRydWUgYWZ0ZXIgc2lnbiB1cC5cbiAgLy8gVmFsdWUgaXMgbG9zdCBpbiBjYXNlIG9mIHJlbG9hZC4gVGhlIGlkZWEgaGVyZSBpcyB0byBrbm93IGlmIHdlIGp1c3Qgc2VudCBhIHZlcmlmaWNhdGlvbiBlbWFpbC5cbiAgZW1haWxDb25maXJtYXRpb25TZW50OiBib29sZWFuO1xuICAvLyBMZWdhY3kgZmlsZWQgdGhhdCBjb250YWluIHRoZSBtYWlsIHRvIGNvbmZpcm0uIFNhbWUgbGlmZWN5Y2xlIHRoYW4gZW1haWxDb25maXJtYXRpb25TZW50LlxuICBlbWFpbFRvQ29uZmlybTogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHB1YmxpYyBhZmE6IEFuZ3VsYXJGaXJlQXV0aCxcbiAgICBASW5qZWN0KGZvcndhcmRSZWYoKCkgPT4gTmd4QXV0aEZpcmViYXNlVUlDb25maWdUb2tlbikpIHB1YmxpYyBjb25maWc6IE5neEF1dGhGaXJlYmFzZVVJQ29uZmlnLFxuICAgIHByaXZhdGUgc25hY2tCYXI6IE1hdFNuYWNrQmFyLFxuICAgIHByaXZhdGUgZmlyZVN0b3JlU2VydmljZTogRmlyZXN0b3JlU3luY1NlcnZpY2UsXG4gICAgQEluamVjdChNQVRfU05BQ0tfQkFSX0RFRkFVTFRfT1BUSU9OUykgcHJpdmF0ZSBtYXRTbmFja0JhckNvbmZpZzogTWF0U25hY2tCYXJDb25maWdcbiAgKSB7XG4gIH1cblxuICBsaXN0ZW5Ub1VzZXJFdmVudHMoKSB7XG4gICAgdGhpcy5hZmEudXNlci5zdWJzY3JpYmUoKHVzZXI6IGZpcmViYXNlLlVzZXIgfCBudWxsKSA9PiB7XG4gICAgICB0aGlzLl91c2VyJC5uZXh0KHVzZXIpO1xuICAgICAgdGhpcy51c2VyID0gdXNlcjtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXNldCB0aGUgcGFzc3dvcmQgb2YgdGhlIG5neC1hdXRoLWZpcmViYXNldWktdXNlciB2aWEgZW1haWxcbiAgICpcbiAgICogQHBhcmFtIGVtYWlsIC0gdGhlIGVtYWlsIHRvIHJlc2V0XG4gICAqL1xuICBwdWJsaWMgYXN5bmMgcmVzZXRQYXNzd29yZChlbWFpbDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnNvbGUubG9nKCdQYXNzd29yZCByZXNldCBlbWFpbCBzZW50Jyk7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5hZmEuc2VuZFBhc3N3b3JkUmVzZXRFbWFpbChlbWFpbCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB0aGlzLm5vdGlmeUVycm9yKGVycm9yKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhbCBzaWduIGluIG1lY2hhbmlzbSB0byBhdXRoZW50aWNhdGUgdGhlIHVzZXJzIHdpdGggYSBmaXJlYmFzZSBwcm9qZWN0XG4gICAqIHVzaW5nIGEgdHJhZGl0aW9uYWwgd2F5LCB2aWEgdXNlcm5hbWUgYW5kIHBhc3N3b3JkIG9yIGJ5IHVzaW5nIGFuIGF1dGhlbnRpY2F0aW9uIHByb3ZpZGVyXG4gICAqIGxpa2UgZ29vZ2xlLCBmYWNlYm9vaywgdHdpdHRlciBhbmQgZ2l0aHViXG4gICAqXG4gICAqIEBwYXJhbSBwcm92aWRlciAtIHRoZSBwcm92aWRlciB0byBhdXRoZW50aWNhdGUgd2l0aCAoZ29vZ2xlLCBmYWNlYm9vaywgdHdpdHRlciwgZ2l0aHViKVxuICAgKiBAcGFyYW0gY3JlZGVudGlhbHMgb3B0aW9uYWwgZW1haWwgYW5kIHBhc3N3b3JkXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgc2lnbkluV2l0aChwcm92aWRlcjogQXV0aFByb3ZpZGVyLCBjcmVkZW50aWFscz86IElDcmVkZW50aWFscykge1xuICAgIHRyeSB7XG4gICAgICBsZXQgc2lnbkluUmVzdWx0OiBVc2VyQ3JlZGVudGlhbCB8IGFueTtcblxuICAgICAgc3dpdGNoIChwcm92aWRlcikge1xuICAgICAgICBjYXNlIEF1dGhQcm92aWRlci5BTk9OWU1PVVM6XG4gICAgICAgICAgc2lnbkluUmVzdWx0ID0gYXdhaXQgdGhpcy5hZmEuc2lnbkluQW5vbnltb3VzbHkoKSBhcyBVc2VyQ3JlZGVudGlhbDtcbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlIEF1dGhQcm92aWRlci5FbWFpbEFuZFBhc3N3b3JkOlxuICAgICAgICAgIHNpZ25JblJlc3VsdCA9IGF3YWl0IHRoaXMuYWZhLnNpZ25JbldpdGhFbWFpbEFuZFBhc3N3b3JkKGNyZWRlbnRpYWxzLmVtYWlsLCBjcmVkZW50aWFscy5wYXNzd29yZCkgYXMgVXNlckNyZWRlbnRpYWw7XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgY2FzZSBBdXRoUHJvdmlkZXIuR29vZ2xlOlxuICAgICAgICAgIHNpZ25JblJlc3VsdCA9IGF3YWl0IHRoaXMuYWZhLnNpZ25JbldpdGhQb3B1cChnb29nbGVBdXRoUHJvdmlkZXIpIGFzIFVzZXJDcmVkZW50aWFsO1xuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGNhc2UgQXV0aFByb3ZpZGVyLkFwcGxlOlxuICAgICAgICAgIHNpZ25JblJlc3VsdCA9IGF3YWl0IHRoaXMuYWZhLnNpZ25JbldpdGhQb3B1cChhcHBsZUF1dGhQcm92aWRlcikgYXMgVXNlckNyZWRlbnRpYWw7XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgY2FzZSBBdXRoUHJvdmlkZXIuRmFjZWJvb2s6XG4gICAgICAgICAgc2lnbkluUmVzdWx0ID0gYXdhaXQgdGhpcy5hZmEuc2lnbkluV2l0aFBvcHVwKGZhY2Vib29rQXV0aFByb3ZpZGVyKSBhcyBVc2VyQ3JlZGVudGlhbDtcbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlIEF1dGhQcm92aWRlci5Ud2l0dGVyOlxuICAgICAgICAgIHNpZ25JblJlc3VsdCA9IGF3YWl0IHRoaXMuYWZhLnNpZ25JbldpdGhQb3B1cCh0d2l0dGVyQXV0aFByb3ZpZGVyKSBhcyBVc2VyQ3JlZGVudGlhbDtcbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlIEF1dGhQcm92aWRlci5HaXRodWI6XG4gICAgICAgICAgc2lnbkluUmVzdWx0ID0gYXdhaXQgdGhpcy5hZmEuc2lnbkluV2l0aFBvcHVwKGdpdGh1YkF1dGhQcm92aWRlcikgYXMgVXNlckNyZWRlbnRpYWw7XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgY2FzZSBBdXRoUHJvdmlkZXIuTWljcm9zb2Z0OlxuICAgICAgICAgIHNpZ25JblJlc3VsdCA9IGF3YWl0IHRoaXMuYWZhLnNpZ25JbldpdGhQb3B1cChtaWNyb3NvZnRBdXRoUHJvdmlkZXIpIGFzIFVzZXJDcmVkZW50aWFsO1xuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGNhc2UgQXV0aFByb3ZpZGVyLllhaG9vOlxuICAgICAgICAgIHNpZ25JblJlc3VsdCA9IGF3YWl0IHRoaXMuYWZhLnNpZ25JbldpdGhQb3B1cCh5YWhvb0F1dGhQcm92aWRlcikgYXMgVXNlckNyZWRlbnRpYWw7XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgY2FzZSBBdXRoUHJvdmlkZXIuUGhvbmVOdW1iZXI6XG4gICAgICAgICAgLy8gY29taW5nIHNvb24gLSBzZWUgZmVhdHVyZS9zbXMgYnJhbmNoXG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7QXV0aFByb3ZpZGVyW3Byb3ZpZGVyXX0gaXMgbm90IGF2YWlsYWJsZSBhcyBhdXRoIHByb3ZpZGVyYCk7XG4gICAgICB9XG4gICAgICBhd2FpdCB0aGlzLmhhbmRsZVN1Y2Nlc3Moc2lnbkluUmVzdWx0KTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHRoaXMuaGFuZGxlRXJyb3IoZXJyKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2lnbiB1cCBuZXcgdXNlcnMgdmlhIGVtYWlsIGFuZCBwYXNzd29yZC5cbiAgICogQWZ0ZXIgdGhhdCB0aGUgbmd4LWF1dGgtZmlyZWJhc2V1aS11c2VyIHNob3VsZCB2ZXJpZnkgYW5kIGNvbmZpcm0gYW4gZW1haWwgc2VudCB2aWEgdGhlIGZpcmViYXNlXG4gICAqXG4gICAqIEBwYXJhbSBkaXNwbGF5TmFtZSAtIHRoZSBkaXNwbGF5TmFtZSBpZiB0aGUgbmV3IG5neC1hdXRoLWZpcmViYXNldWktdXNlclxuICAgKiBAcGFyYW0gY3JlZGVudGlhbHMgZW1haWwgYW5kIHBhc3N3b3JkXG4gICAqIEByZXR1cm5zIC1cbiAgICovXG4gIHB1YmxpYyBhc3luYyBzaWduVXAoZGlzcGxheU5hbWU6IHN0cmluZywgY3JlZGVudGlhbHM6IElDcmVkZW50aWFscykge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB1c2VyQ3JlZGVudGlhbDogVXNlckNyZWRlbnRpYWwgPSBhd2FpdCB0aGlzLmFmYS5jcmVhdGVVc2VyV2l0aEVtYWlsQW5kUGFzc3dvcmQoY3JlZGVudGlhbHMuZW1haWwsIGNyZWRlbnRpYWxzLnBhc3N3b3JkKTtcbiAgICAgIGNvbnN0IHVzZXIgPSB1c2VyQ3JlZGVudGlhbC51c2VyO1xuICAgICAgYXdhaXQgdGhpcy51cGRhdGVQcm9maWxlKGRpc3BsYXlOYW1lLCB1c2VyLnBob3RvVVJMKTtcblxuICAgICAgaWYgKHRoaXMuY29uZmlnLmVuYWJsZUZpcmVzdG9yZVN5bmMpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5maXJlU3RvcmVTZXJ2aWNlXG4gICAgICAgICAgLmdldFVzZXJEb2NSZWZCeVVJRCh1c2VyLnVpZClcbiAgICAgICAgICAuc2V0KHtcbiAgICAgICAgICAgIHVpZDogdXNlci51aWQsXG4gICAgICAgICAgICBkaXNwbGF5TmFtZSxcbiAgICAgICAgICAgIGVtYWlsOiB1c2VyLmVtYWlsLFxuICAgICAgICAgICAgcGhvdG9VUkw6IHVzZXIucGhvdG9VUkxcbiAgICAgICAgICB9IGFzIFVzZXIpO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5jb25maWcuZW5hYmxlRW1haWxWZXJpZmljYXRpb24pIHtcbiAgICAgICAgYXdhaXQgdXNlci5zZW5kRW1haWxWZXJpZmljYXRpb24oKTtcbiAgICAgIH1cblxuICAgICAgLy8gTGVnYWN5IGZpZWxkc1xuICAgICAgdGhpcy5lbWFpbENvbmZpcm1hdGlvblNlbnQgPSB0cnVlO1xuICAgICAgdGhpcy5lbWFpbFRvQ29uZmlybSA9IGNyZWRlbnRpYWxzLmVtYWlsO1xuXG4gICAgICBhd2FpdCB0aGlzLmhhbmRsZVN1Y2Nlc3ModXNlckNyZWRlbnRpYWwpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgdGhpcy5oYW5kbGVFcnJvcihlcnIpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHNlbmROZXdWZXJpZmljYXRpb25FbWFpbCgpOiBQcm9taXNlPHZvaWQgfCBuZXZlcj4ge1xuICAgIGlmICghdGhpcy51c2VyKSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKCdObyBzaWduZWQgaW4gdXNlcicpKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMudXNlci5zZW5kRW1haWxWZXJpZmljYXRpb24oKTtcbiAgfVxuXG4gIGFzeW5jIHNpZ25PdXQoKSB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuYWZhLnNpZ25PdXQoKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5ub3RpZnlFcnJvcihlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSB0aGUgcHJvZmlsZSAobmFtZSArIHBob3RvIHVybCkgb2YgdGhlIGF1dGhlbnRpY2F0ZWQgbmd4LWF1dGgtZmlyZWJhc2V1aS11c2VyIGluIHRoZVxuICAgKiBmaXJlYmFzZSBhdXRoZW50aWNhdGlvbiBmZWF0dXJlIChub3QgaW4gZmlyZXN0b3JlKVxuICAgKlxuICAgKiBAcGFyYW0gbmFtZSAtIHRoZSBuZXcgbmFtZSBvZiB0aGUgYXV0aGVudGljYXRlZCBuZ3gtYXV0aC1maXJlYmFzZXVpLXVzZXJcbiAgICogQHBhcmFtIHBob3RvVVJMIC0gdGhlIG5ldyBwaG90byB1cmwgb2YgdGhlIGF1dGhlbnRpY2F0ZWQgbmd4LWF1dGgtZmlyZWJhc2V1aS11c2VyXG4gICAqIEByZXR1cm5zIC1cbiAgICovXG4gIHB1YmxpYyB1cGRhdGVQcm9maWxlKG5hbWU6IHN0cmluZywgcGhvdG9VUkw6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIHJldHVybiB0aGlzLmFmYS5jdXJyZW50VXNlci50aGVuKCh1c2VyOiBVc2VyKSA9PiB7XG4gICAgICBpZiAoIXBob3RvVVJMKSB7XG4gICAgICAgIHJldHVybiB1c2VyLnVwZGF0ZVByb2ZpbGUoe2Rpc3BsYXlOYW1lOiBuYW1lfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdXNlci51cGRhdGVQcm9maWxlKHtkaXNwbGF5TmFtZTogbmFtZSwgcGhvdG9VUkx9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBwYXJzZVVzZXJJbmZvKHVzZXI6IFVzZXIpOiBVc2VySW5mbyB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHVpZDogdXNlci51aWQsXG4gICAgICBkaXNwbGF5TmFtZTogdXNlci5kaXNwbGF5TmFtZSxcbiAgICAgIGVtYWlsOiB1c2VyLmVtYWlsLFxuICAgICAgcGhvbmVOdW1iZXI6IHVzZXIucGhvbmVOdW1iZXIsXG4gICAgICBwaG90b1VSTDogdXNlci5waG90b1VSTCxcbiAgICAgIHByb3ZpZGVySWQ6IHVzZXIucHJvdmlkZXJEYXRhLmxlbmd0aCA+IDAgPyB1c2VyLnByb3ZpZGVyRGF0YVswXS5wcm92aWRlcklkIDogbnVsbFxuICAgIH07XG4gIH1cblxuICBwdWJsaWMgZ2V0VXNlclBob3RvVXJsKCk6IE9ic2VydmFibGU8c3RyaW5nIHwgbnVsbD4ge1xuICAgIHJldHVybiB0aGlzLl91c2VyJC5waXBlKFxuICAgICAgbWFwKCh1c2VyOiBmaXJlYmFzZS5Vc2VyIHwgbnVsbCkgPT4ge1xuICAgICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfSBlbHNlIGlmICh1c2VyLnBob3RvVVJMKSB7XG4gICAgICAgICAgcmV0dXJuIHVzZXIucGhvdG9VUkw7XG4gICAgICAgIH0gZWxzZSBpZiAodXNlci5lbWFpbFZlcmlmaWVkKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UGhvdG9QYXRoKEFjY291bnRzLkNIRUNLKTtcbiAgICAgICAgfSBlbHNlIGlmICh1c2VyLmlzQW5vbnltb3VzKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UGhvdG9QYXRoKEFjY291bnRzLk9GRik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UGhvdG9QYXRoKEFjY291bnRzLk5PTkUpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICk7XG4gIH1cblxuICBwdWJsaWMgZ2V0UGhvdG9QYXRoKGltYWdlOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiBgYXNzZXRzL3VzZXIvJHtpbWFnZX0uc3ZnYDtcbiAgfVxuXG4gIHB1YmxpYyBzaWduSW5XaXRoUGhvbmVOdW1iZXIoKSB7XG4gICAgLy8gdG9kbzogMy4xLjE4XG4gIH1cblxuICBhc3luYyBoYW5kbGVTdWNjZXNzKHVzZXJDcmVkZW50aWFsOiBVc2VyQ3JlZGVudGlhbCkge1xuICAgIHRoaXMub25TdWNjZXNzRW1pdHRlci5uZXh0KHVzZXJDcmVkZW50aWFsLnVzZXIpO1xuICAgIGlmICh0aGlzLmNvbmZpZy5lbmFibGVGaXJlc3RvcmVTeW5jKSB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLmZpcmVTdG9yZVNlcnZpY2UudXBkYXRlVXNlckRhdGEodGhpcy5wYXJzZVVzZXJJbmZvKHVzZXJDcmVkZW50aWFsLnVzZXIpKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihgRXJyb3Igb2NjdXJyZWQgd2hpbGUgdXBkYXRpbmcgdXNlciBkYXRhIHdpdGggZmlyZXN0b3JlOiAke2V9YCk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmICh0aGlzLmNvbmZpZy50b2FzdE1lc3NhZ2VPbkF1dGhTdWNjZXNzKSB7XG4gICAgICBjb25zdCBmYWxsYmFja01lc3NhZ2UgPSBgSGVsbG8gJHt1c2VyQ3JlZGVudGlhbC51c2VyLmRpc3BsYXlOYW1lID8gdXNlckNyZWRlbnRpYWwudXNlci5kaXNwbGF5TmFtZSA6ICcnfSFgO1xuICAgICAgdGhpcy5zaG93VG9hc3QodGhpcy5tZXNzYWdlT25BdXRoU3VjY2VzcyB8fCBmYWxsYmFja01lc3NhZ2UpO1xuICAgIH1cbiAgfVxuXG4gIGhhbmRsZUVycm9yKGVycm9yOiBhbnkpIHtcbiAgICB0aGlzLm5vdGlmeUVycm9yKGVycm9yKTtcbiAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgfVxuXG4gIC8vIFJlZnJlc2ggdXNlciBpbmZvLiBDYW4gYmUgdXNlZnVsIGZvciBpbnN0YW5jZSB0byBnZXQgbGF0ZXN0IHN0YXR1cyByZWdhcmRpbmcgZW1haWwgdmVyaWZpY2F0aW9uLlxuICByZWxvYWRVc2VySW5mbygpIHtcbiAgICByZXR1cm4gdGhpcy5fdXNlciQucGlwZSh0YWtlKDEpKS5zdWJzY3JpYmUoKHVzZXI6IFVzZXIgfCBudWxsKSA9PiB1c2VyICYmIHVzZXIucmVsb2FkKCkpO1xuICB9XG5cbiAgLy8gU2VhcmNoIGZvciBhbiBlcnJvciBtZXNzYWdlLlxuICAvLyBDb25zdW1lcnMgb2YgdGhpcyBsaWJyYXJ5IGFyZSBnaXZlbiB0aGUgcG9zc2liaWxpdHkgdG8gcHJvdmlkZSBhXG4gIC8vIGZ1bmN0aW9uIGluIGNhc2UgdGhleSB3YW50IHRvIGluc3RydW1lbnQgbWVzc2FnZSBiYXNlZCBvbiBlcnJvciBwcm9wZXJ0aWVzLlxuICBnZXRNZXNzYWdlT25BdXRoRXJyb3IoZXJyb3I6IGFueSkge1xuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1iaXR3aXNlXG4gICAgcmV0dXJuIGVycm9yLnRvU3RyaW5nKCkgfHwgJ1NvcnJ5LCBzb21ldGhpbmcgd2VudCB3cm9uZy4gUGxlYXNlIHJldHJ5IGxhdGVyLic7XG4gIH1cblxuICAvLyBTaG93IGEgdG9hc3QgdXNpbmcgY3VycmVudCBzbmFja2JhciBjb25maWcuIElmIG1lc3NhZ2UgaXMgZW1wdHksIG5vIHRvYXN0IGlzIGRpc3BsYXllZCBhbGxvd2luZyB0byBvcHQtb3V0IHdoZW4gbmVlZGVkLlxuICAvLyBEZWZhdWx0IE1hdFNuYWNrQmFyQ29uZmlnIGhhcyBubyBkdXJhdGlvbiwgbWVhbmluZyBpdCBzdGF5cyB2aXNpYmxlIGZvcmV2ZXIuXG4gIC8vIElmIHRoYXQncyB0aGUgY2FzZSwgYW4gYWN0aW9uIGJ1dHRvbiBpcyBhZGRlZCB0byBhbGxvdyB0aGUgZW5kLXVzZXIgdG8gZGlzbWlzcyB0aGUgdG9hc3QuXG4gIHNob3dUb2FzdChtZXNzYWdlOiBzdHJpbmcpIHtcbiAgICBpZiAobWVzc2FnZSkge1xuICAgICAgdGhpcy5zbmFja0Jhci5vcGVuKG1lc3NhZ2UsIHRoaXMubWF0U25hY2tCYXJDb25maWcuZHVyYXRpb24gPyBudWxsIDogJ09LJyk7XG4gICAgfVxuICB9XG5cbiAgc2hvd0Vycm9yVG9hc3QoZXJyb3I6IGFueSkge1xuICAgIGlmICh0aGlzLmNvbmZpZy50b2FzdE1lc3NhZ2VPbkF1dGhFcnJvcikge1xuICAgICAgdGhpcy5zaG93VG9hc3QodGhpcy5nZXRNZXNzYWdlT25BdXRoRXJyb3IoZXJyb3IpKTtcbiAgICB9XG4gIH1cblxuICBub3RpZnlFcnJvcihlcnJvcjogYW55KSB7XG4gICAgdGhpcy5vbkVycm9yRW1pdHRlci5lbWl0KGVycm9yKTtcbiAgICB0aGlzLnNob3dFcnJvclRvYXN0KGVycm9yKTtcbiAgfVxuXG59XG4iXX0=
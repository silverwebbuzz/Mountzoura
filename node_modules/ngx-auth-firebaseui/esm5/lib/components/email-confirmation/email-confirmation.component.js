import { __awaiter, __decorate, __generator } from "tslib";
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, EventEmitter, Input, OnChanges, OnInit, Output, SimpleChanges, TemplateRef, ViewChild } from '@angular/core';
import { Router } from '@angular/router';
import { AuthProcessService } from '../../services/auth-process.service';
var defaultTranslations = {
    verifyEmailTitleText: 'Confirm your e-mail address!',
    verifyEmailConfirmationText: 'A confirmation e-mail has been sent.' +
        ' Check your inbox and click on the link "Confirm my e-mail" to confirm your e-mail address.',
    verifyEmailGoBackText: 'Go back',
    sendNewVerificationEmailText: 'Send new confirmation e-mail',
    signOutText: 'Sign out',
    messageOnEmailConfirmationSuccess: 'A new confirmation e-mail has been sent. Please check your inbox.',
};
var EmailConfirmationComponent = /** @class */ (function () {
    function EmailConfirmationComponent(authProcess, router, changeDetectorRef) {
        this.authProcess = authProcess;
        this.router = router;
        this.changeDetectorRef = changeDetectorRef;
        this.signOut = new EventEmitter();
    }
    EmailConfirmationComponent.prototype.ngOnChanges = function (changes) {
        if (changes.verifyEmailTemplate && changes.verifyEmailTemplate.currentValue == null) {
            this.verifyEmailTemplate = this.defaultTemplate;
            console.log('ngOnChanges - defaultTemplate:', this.verifyEmailTemplate);
        }
        this.verifyEmailContext = this.createTemplateContext();
    };
    EmailConfirmationComponent.prototype.ngOnInit = function () {
        if (!this.verifyEmailTemplate) {
            console.log('ngOnInit - defaultTemplate');
            this.verifyEmailTemplate = this.defaultTemplate;
        }
        this.verifyEmailContext = this.createTemplateContext();
        console.log('verifyEmailTemplate:', this.verifyEmailTemplate);
        console.log('verifyEmailContext:', this.verifyEmailContext);
    };
    EmailConfirmationComponent.prototype.continue = function () {
        return __awaiter(this, void 0, void 0, function () {
            var error_1;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 3, , 4]);
                        return [4 /*yield*/, this.authProcess.reloadUserInfo()];
                    case 1:
                        _a.sent();
                        return [4 /*yield*/, this.router.navigate([this.goBackURL])];
                    case 2:
                        _a.sent();
                        return [3 /*break*/, 4];
                    case 3:
                        error_1 = _a.sent();
                        this.authProcess.notifyError(error_1);
                        return [3 /*break*/, 4];
                    case 4: return [2 /*return*/];
                }
            });
        });
    };
    EmailConfirmationComponent.prototype.sendNewVerificationEmail = function () {
        return __awaiter(this, void 0, void 0, function () {
            var error_2;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 2, 3, 4]);
                        this.isLoading = true;
                        this.changeDetectorRef.markForCheck();
                        return [4 /*yield*/, this.authProcess.sendNewVerificationEmail()];
                    case 1:
                        _a.sent();
                        this.authProcess.showToast(this.verifyEmailContext.messageOnEmailConfirmationSuccess);
                        return [3 /*break*/, 4];
                    case 2:
                        error_2 = _a.sent();
                        this.authProcess.notifyError(error_2);
                        return [3 /*break*/, 4];
                    case 3:
                        this.isLoading = false;
                        this.changeDetectorRef.markForCheck();
                        return [7 /*endfinally*/];
                    case 4: return [2 /*return*/];
                }
            });
        });
    };
    EmailConfirmationComponent.prototype.createTemplateContext = function () {
        return {
            email: this.email,
            goBackURL: this.goBackURL,
            verifyEmailTitleText: this.verifyEmailTitleText || defaultTranslations.verifyEmailTitleText,
            verifyEmailConfirmationText: this.verifyEmailConfirmationText || defaultTranslations.verifyEmailConfirmationText,
            verifyEmailGoBackText: this.verifyEmailGoBackText || defaultTranslations.verifyEmailGoBackText,
            sendNewVerificationEmailText: this.sendNewVerificationEmailText || defaultTranslations.sendNewVerificationEmailText,
            signOutText: this.signOutText || defaultTranslations.signOutText,
            messageOnEmailConfirmationSuccess: this.messageOnEmailConfirmationSuccess || defaultTranslations.messageOnEmailConfirmationSuccess
        };
    };
    EmailConfirmationComponent.ctorParameters = function () { return [
        { type: AuthProcessService },
        { type: Router },
        { type: ChangeDetectorRef }
    ]; };
    __decorate([
        Input()
    ], EmailConfirmationComponent.prototype, "email", void 0);
    __decorate([
        Input()
    ], EmailConfirmationComponent.prototype, "goBackURL", void 0);
    __decorate([
        Input()
    ], EmailConfirmationComponent.prototype, "verifyEmailTitleText", void 0);
    __decorate([
        Input()
    ], EmailConfirmationComponent.prototype, "verifyEmailConfirmationText", void 0);
    __decorate([
        Input()
    ], EmailConfirmationComponent.prototype, "verifyEmailGoBackText", void 0);
    __decorate([
        Input()
    ], EmailConfirmationComponent.prototype, "sendNewVerificationEmailText", void 0);
    __decorate([
        Input()
    ], EmailConfirmationComponent.prototype, "signOutText", void 0);
    __decorate([
        Input()
    ], EmailConfirmationComponent.prototype, "messageOnEmailConfirmationSuccess", void 0);
    __decorate([
        Input()
    ], EmailConfirmationComponent.prototype, "template", void 0);
    __decorate([
        Output()
    ], EmailConfirmationComponent.prototype, "signOut", void 0);
    __decorate([
        ViewChild('defaultVerifyEmail', { static: true })
    ], EmailConfirmationComponent.prototype, "defaultTemplate", void 0);
    EmailConfirmationComponent = __decorate([
        Component({
            selector: 'ngx-auth-firebaseui-email-confirmation',
            template: "<ng-container *ngTemplateOutlet=\"verifyEmailTemplate; context: verifyEmailContext\"></ng-container>\n<ng-template #defaultVerifyEmail let-email=\"email\" let-goBackURL=\"goBackURL\"\n             let-sendNewVerificationEmailText=\"sendNewVerificationEmailText\"\n             let-signOutText=\"signOutText\"\n             let-verifyEmailConfirmationText=\"verifyEmailConfirmationText\" let-verifyEmailGoBackText=\"verifyEmailGoBackText\"\n             let-verifyEmailTitleText=\"verifyEmailTitleText\">\n  <mat-card class=\"verify-email\">\n    <mat-card-content fxLayout=\"column\" fxLayoutAlign=\"center center\">\n      <mat-icon>email</mat-icon>\n      <p class=\"title\" fxLayout=\"column\" fxLayoutAlign=\"center center\">\n        <span class=\"mat-subheading-2\">{{ verifyEmailTitleText }}</span>\n        <span class=\"mat-body-2\">{{ email }}</span>\n      </p>\n      <p class=\"subtitle\">{{ verifyEmailConfirmationText }}</p>\n      <mat-progress-bar *ngIf=\"isLoading\" mode=\"indeterminate\"></mat-progress-bar>\n    </mat-card-content>\n    <mat-card-actions fxLayout=\"column\" fxLayoutAlign=\"center center\">\n      <button (click)=\"continue()\" *ngIf=\"goBackURL\" class=\"go-back-button action-button\" mat-stroked-button>\n        {{ verifyEmailGoBackText }}\n      </button>\n      <button (click)=\"sendNewVerificationEmail()\" class=\"send-new-mail-button action-button\"\n              mat-stroked-button>{{ sendNewVerificationEmailText }}</button>\n      <button (click)=\"this.signOut.emit()\" class=\"sign-out-button action-button\" color=\"warn\"\n              mat-stroked-button>{{ signOutText }}</button>\n    </mat-card-actions>\n  </mat-card>\n</ng-template>\n",
            changeDetection: ChangeDetectionStrategy.OnPush,
            styles: [".material-icons{font-size:4rem}.verify-email{width:360px}.verify-email .mat-icon{height:4rem;width:4rem;color:#444}.verify-email .title{margin-top:16px}.verify-email .title .mat-subheading-2{margin-bottom:0}.verify-email .subtitle{margin:16px auto;text-align:justify}.verify-email p{display:block;-webkit-margin-before:1em;-webkit-margin-after:1em;-webkit-margin-start:0;-webkit-margin-end:0}.verify-email mat-card-actions{text-align:center;margin-top:1rem}.verify-email mat-card-actions .action-button{width:100%}.verify-email mat-card-actions .action-button+.action-button{margin-top:1rem}"]
        })
    ], EmailConfirmationComponent);
    return EmailConfirmationComponent;
}());
export { EmailConfirmationComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW1haWwtY29uZmlybWF0aW9uLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1hdXRoLWZpcmViYXNldWkvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9lbWFpbC1jb25maXJtYXRpb24vZW1haWwtY29uZmlybWF0aW9uLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUNMLHVCQUF1QixFQUN2QixpQkFBaUIsRUFDakIsU0FBUyxFQUNULFlBQVksRUFDWixLQUFLLEVBQ0wsU0FBUyxFQUNULE1BQU0sRUFDTixNQUFNLEVBQ04sYUFBYSxFQUNiLFdBQVcsRUFDWCxTQUFTLEVBQ1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFDLE1BQU0sRUFBQyxNQUFNLGlCQUFpQixDQUFDO0FBQ3ZDLE9BQU8sRUFBQyxrQkFBa0IsRUFBQyxNQUFNLHFDQUFxQyxDQUFDO0FBWXZFLElBQU0sbUJBQW1CLEdBQUc7SUFDMUIsb0JBQW9CLEVBQUUsOEJBQThCO0lBQ3BELDJCQUEyQixFQUFFLHNDQUFzQztRQUNqRSw2RkFBNkY7SUFDL0YscUJBQXFCLEVBQUUsU0FBUztJQUNoQyw0QkFBNEIsRUFBRSw4QkFBOEI7SUFDNUQsV0FBVyxFQUFFLFVBQVU7SUFDdkIsaUNBQWlDLEVBQUUsbUVBQW1FO0NBQ3ZHLENBQUM7QUFRRjtJQTBCRSxvQ0FBbUIsV0FBK0IsRUFBVSxNQUFjLEVBQVUsaUJBQW9DO1FBQXJHLGdCQUFXLEdBQVgsV0FBVyxDQUFvQjtRQUFVLFdBQU0sR0FBTixNQUFNLENBQVE7UUFBVSxzQkFBaUIsR0FBakIsaUJBQWlCLENBQW1CO1FBWDlHLFlBQU8sR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO0lBWXZDLENBQUM7SUFFRCxnREFBVyxHQUFYLFVBQVksT0FBc0I7UUFDaEMsSUFBSSxPQUFPLENBQUMsbUJBQW1CLElBQUksT0FBTyxDQUFDLG1CQUFtQixDQUFDLFlBQVksSUFBSSxJQUFJLEVB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QUFSLEtBQUssRUFBRTs2RUFBK0I7SUFDOUI7UUFBUixLQUFLLEVBQUU7b0ZBQXNDO0lBQ3JDO1FBQVIsS0FBSyxFQUFFO21FQUFxQjtJQUNwQjtRQUFSLEtBQUssRUFBRTt5RkFBMkM7SUFHMUM7UUFBUixLQUFLLEVBQUU7Z0VBQTRCO0lBRTFCO1FBQVQsTUFBTSxFQUFFOytEQUE4QjtJQVNVO1FBQWhELFNBQVMsQ0FBQyxvQkFBb0IsRUFBRSxFQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUMsQ0FBQzt1RUFBbUM7SUF4QnhFLDBCQUEwQjtRQU50QyxTQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsd0NBQXdDO1lBQ2xELDZxREFBa0Q7WUFFbEQsZUFBZSxFQUFFLHVCQUF1QixDQUFDLE1BQU07O1NBQ2hELENBQUM7T0FDVywwQkFBMEIsQ0FrRnRDO0lBQUQsaUNBQUM7Q0FBQSxBQWxGRCxJQWtGQztTQWxGWSwwQkFBMEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIENvbXBvbmVudCxcbiAgRXZlbnRFbWl0dGVyLFxuICBJbnB1dCxcbiAgT25DaGFuZ2VzLFxuICBPbkluaXQsXG4gIE91dHB1dCxcbiAgU2ltcGxlQ2hhbmdlcyxcbiAgVGVtcGxhdGVSZWYsXG4gIFZpZXdDaGlsZFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7Um91dGVyfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHtBdXRoUHJvY2Vzc1NlcnZpY2V9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2F1dGgtcHJvY2Vzcy5zZXJ2aWNlJztcblxuaW50ZXJmYWNlIFZlcmlmeUVtYWlsQ29udGV4dCB7XG4gIGVtYWlsOiBzdHJpbmc7XG4gIGdvQmFja1VSTDogc3RyaW5nO1xuICB2ZXJpZnlFbWFpbFRpdGxlVGV4dDogc3RyaW5nO1xuICB2ZXJpZnlFbWFpbENvbmZpcm1hdGlvblRleHQ6IHN0cmluZztcbiAgdmVyaWZ5RW1haWxHb0JhY2tUZXh0OiBzdHJpbmc7XG4gIG1lc3NhZ2VPbkVtYWlsQ29uZmlybWF0aW9uU3VjY2Vzczogc3RyaW5nO1xuICBtZXNzYWdlT25FcnJvcjogc3RyaW5nO1xufVxuXG5jb25zdCBkZWZhdWx0VHJhbnNsYXRpb25zID0ge1xuICB2ZXJpZnlFbWFpbFRpdGxlVGV4dDogJ0NvbmZpcm0geW91ciBlLW1haWwgYWRkcmVzcyEnLFxuICB2ZXJpZnlFbWFpbENvbmZpcm1hdGlvblRleHQ6ICdBIGNvbmZpcm1hdGlvbiBlLW1haWwgaGFzIGJlZW4gc2VudC4nICtcbiAgICAnIENoZWNrIHlvdXIgaW5ib3ggYW5kIGNsaWNrIG9uIHRoZSBsaW5rIFwiQ29uZmlybSBteSBlLW1haWxcIiB0byBjb25maXJtIHlvdXIgZS1tYWlsIGFkZHJlc3MuJyxcbiAgdmVyaWZ5RW1haWxHb0JhY2tUZXh0OiAnR28gYmFjaycsXG4gIHNlbmROZXdWZXJpZmljYXRpb25FbWFpbFRleHQ6ICdTZW5kIG5ldyBjb25maXJtYXRpb24gZS1tYWlsJyxcbiAgc2lnbk91dFRleHQ6ICdTaWduIG91dCcsXG4gIG1lc3NhZ2VPbkVtYWlsQ29uZmlybWF0aW9uU3VjY2VzczogJ0EgbmV3IGNvbmZpcm1hdGlvbiBlLW1haWwgaGFzIGJlZW4gc2VudC4gUGxlYXNlIGNoZWNrIHlvdXIgaW5ib3guJyxcbn07XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ25neC1hdXRoLWZpcmViYXNldWktZW1haWwtY29uZmlybWF0aW9uJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2VtYWlsLWNvbmZpcm1hdGlvbi5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2VtYWlsLWNvbmZpcm1hdGlvbi5jb21wb25lbnQuc2NzcyddLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxufSlcbmV4cG9ydCBjbGFzcyBFbWFpbENvbmZpcm1hdGlvbkNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcblxuICBASW5wdXQoKSBlbWFpbDogc3RyaW5nO1xuICBASW5wdXQoKSBnb0JhY2tVUkw6IHN0cmluZztcbiAgLy8gaTE4biB0cmFuc2xhdGlvbnMgdG8gdXNlIGluIGRlZmF1bHQgdGVtcGxhdGVcbiAgQElucHV0KCkgdmVyaWZ5RW1haWxUaXRsZVRleHQ6IHN0cmluZztcbiAgQElucHV0KCkgdmVyaWZ5RW1haWxDb25maXJtYXRpb25UZXh0OiBzdHJpbmc7XG4gIEBJbnB1dCgpIHZlcmlmeUVtYWlsR29CYWNrVGV4dDogc3RyaW5nO1xuICBASW5wdXQoKSBzZW5kTmV3VmVyaWZpY2F0aW9uRW1haWxUZXh0OiBzdHJpbmc7XG4gIEBJbnB1dCgpIHNpZ25PdXRUZXh0OiBzdHJpbmc7XG4gIEBJbnB1dCgpIG1lc3NhZ2VPbkVtYWlsQ29uZmlybWF0aW9uU3VjY2Vzczogc3RyaW5nO1xuXG4gIC8vIFRlbXBsYXRlIHRvIHVzZSBpbiBwbGFjZSBvZiBkZWZhdWx0IHRlbXBsYXRlXG4gIEBJbnB1dCgpIHRlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+O1xuXG4gIEBPdXRwdXQoKSBzaWduT3V0ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIC8vIEZpbmFsIHRlbXBsYXRlXG4gIHZlcmlmeUVtYWlsVGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT47XG4gIC8vIENvbnRleHQgaGFzaCB0byB1c2UgZm9yIHZlcmlmeUVtYWlsVGVtcGxhdGUuXG4gIHZlcmlmeUVtYWlsQ29udGV4dDogVmVyaWZ5RW1haWxDb250ZXh0O1xuXG4gIGlzTG9hZGluZzogYm9vbGVhbjtcblxuICBAVmlld0NoaWxkKCdkZWZhdWx0VmVyaWZ5RW1haWwnLCB7c3RhdGljOiB0cnVlfSkgZGVmYXVsdFRlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+O1xuXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBhdXRoUHJvY2VzczogQXV0aFByb2Nlc3NTZXJ2aWNlLCBwcml2YXRlIHJvdXRlcjogUm91dGVyLCBwcml2YXRlIGNoYW5nZURldGVjdG9yUmVmOiBDaGFuZ2VEZXRlY3RvclJlZikge1xuICB9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xuICAgIGlmIChjaGFuZ2VzLnZlcmlmeUVtYWlsVGVtcGxhdGUgJiYgY2hhbmdlcy52ZXJpZnlFbWFpbFRlbXBsYXRlLmN1cnJlbnRWYWx1ZSA9PSBudWxsKSB7XG4gICAgICB0aGlzLnZlcmlmeUVtYWlsVGVtcGxhdGUgPSB0aGlzLmRlZmF1bHRUZW1wbGF0ZTtcbiAgICAgIGNvbnNvbGUubG9nKCduZ09uQ2hhbmdlcyAtIGRlZmF1bHRUZW1wbGF0ZTonLCB0aGlzLnZlcmlmeUVtYWlsVGVtcGxhdGUpO1xuICAgIH1cbiAgICB0aGlzLnZlcmlmeUVtYWlsQ29udGV4dCA9IHRoaXMuY3JlYXRlVGVtcGxhdGVDb250ZXh0KCk7XG4gIH1cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMudmVyaWZ5RW1haWxUZW1wbGF0ZSkge1xuICAgICAgY29uc29sZS5sb2coJ25nT25Jbml0IC0gZGVmYXVsdFRlbXBsYXRlJyk7XG4gICAgICB0aGlzLnZlcmlmeUVtYWlsVGVtcGxhdGUgPSB0aGlzLmRlZmF1bHRUZW1wbGF0ZTtcbiAgICB9XG4gICAgdGhpcy52ZXJpZnlFbWFpbENvbnRleHQgPSB0aGlzLmNyZWF0ZVRlbXBsYXRlQ29udGV4dCgpO1xuICAgIGNvbnNvbGUubG9nKCd2ZXJpZnlFbWFpbFRlbXBsYXRlOicsIHRoaXMudmVyaWZ5RW1haWxUZW1wbGF0ZSk7XG4gICAgY29uc29sZS5sb2coJ3ZlcmlmeUVtYWlsQ29udGV4dDonLCB0aGlzLnZlcmlmeUVtYWlsQ29udGV4dCk7XG4gIH1cblxuICBhc3luYyBjb250aW51ZSgpIHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5hdXRoUHJvY2Vzcy5yZWxvYWRVc2VySW5mbygpO1xuICAgICAgYXdhaXQgdGhpcy5yb3V0ZXIubmF2aWdhdGUoW3RoaXMuZ29CYWNrVVJMXSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMuYXV0aFByb2Nlc3Mubm90aWZ5RXJyb3IoZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHNlbmROZXdWZXJpZmljYXRpb25FbWFpbCgpIHtcbiAgICB0cnkge1xuICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlO1xuICAgICAgdGhpcy5jaGFuZ2VEZXRlY3RvclJlZi5tYXJrRm9yQ2hlY2soKTtcbiAgICAgIGF3YWl0IHRoaXMuYXV0aFByb2Nlc3Muc2VuZE5ld1ZlcmlmaWNhdGlvbkVtYWlsKCk7XG4gICAgICB0aGlzLmF1dGhQcm9jZXNzLnNob3dUb2FzdCh0aGlzLnZlcmlmeUVtYWlsQ29udGV4dC5tZXNzYWdlT25FbWFpbENvbmZpcm1hdGlvblN1Y2Nlc3MpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmF1dGhQcm9jZXNzLm5vdGlmeUVycm9yKGVycm9yKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICAgIHRoaXMuY2hhbmdlRGV0ZWN0b3JSZWYubWFya0ZvckNoZWNrKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVUZW1wbGF0ZUNvbnRleHQoKTogYW55IHtcbiAgICByZXR1cm4ge1xuICAgICAgZW1haWw6IHRoaXMuZW1haWwsXG4gICAgICBnb0JhY2tVUkw6IHRoaXMuZ29CYWNrVVJMLFxuICAgICAgdmVyaWZ5RW1haWxUaXRsZVRleHQ6IHRoaXMudmVyaWZ5RW1haWxUaXRsZVRleHQgfHwgZGVmYXVsdFRyYW5zbGF0aW9ucy52ZXJpZnlFbWFpbFRpdGxlVGV4dCxcbiAgICAgIHZlcmlmeUVtYWlsQ29uZmlybWF0aW9uVGV4dDogdGhpcy52ZXJpZnlFbWFpbENvbmZpcm1hdGlvblRleHQgfHwgZGVmYXVsdFRyYW5zbGF0aW9ucy52ZXJpZnlFbWFpbENvbmZpcm1hdGlvblRleHQsXG4gICAgICB2ZXJpZnlFbWFpbEdvQmFja1RleHQ6IHRoaXMudmVyaWZ5RW1haWxHb0JhY2tUZXh0IHx8IGRlZmF1bHRUcmFuc2xhdGlvbnMudmVyaWZ5RW1haWxHb0JhY2tUZXh0LFxuICAgICAgc2VuZE5ld1ZlcmlmaWNhdGlvbkVtYWlsVGV4dDogdGhpcy5zZW5kTmV3VmVyaWZpY2F0aW9uRW1haWxUZXh0IHx8IGRlZmF1bHRUcmFuc2xhdGlvbnMuc2VuZE5ld1ZlcmlmaWNhdGlvbkVtYWlsVGV4dCxcbiAgICAgIHNpZ25PdXRUZXh0OiB0aGlzLnNpZ25PdXRUZXh0IHx8IGRlZmF1bHRUcmFuc2xhdGlvbnMuc2lnbk91dFRleHQsXG4gICAgICBtZXNzYWdlT25FbWFpbENvbmZpcm1hdGlvblN1Y2Nlc3M6IHRoaXMubWVzc2FnZU9uRW1haWxDb25maXJtYXRpb25TdWNjZXNzIHx8IGRlZmF1bHRUcmFuc2xhdGlvbnMubWVzc2FnZU9uRW1haWxDb25maXJtYXRpb25TdWNjZXNzXG4gICAgfTtcbiAgfVxufVxuIl19
import { __awaiter, __decorate, __generator, __param } from "tslib";
import { Component, EventEmitter, Inject, Input, Output, PLATFORM_ID, ViewEncapsulation } from '@angular/core';
import { AbstractControl, FormBuilder, FormGroup, ValidationErrors, ValidatorFn, Validators } from '@angular/forms';
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { NgxAuthFirebaseuiAnimations } from '../../animations';
import { AuthProcessService } from '../../services/auth-process.service';
import { isPlatformBrowser } from '@angular/common';
export var confirmPasswordValidator = function (control) {
    if (!control.parent || !control) {
        return null;
    }
    var password = control.parent.get('password');
    var passwordConfirm = control.parent.get('passwordConfirm');
    if (!password || !passwordConfirm) {
        return null;
    }
    if (passwordConfirm.value === '') {
        return null;
    }
    if (password.value === passwordConfirm.value) {
        return null;
    }
    return { passwordsNotMatching: true };
};
var NgxAuthFirebaseuiRegisterComponent = /** @class */ (function () {
    // tslint:disable-next-line:ban-types
    function NgxAuthFirebaseuiRegisterComponent(platformId, formBuilder, authProcess) {
        // Configure the layout
        this.platformId = platformId;
        this.formBuilder = formBuilder;
        this.authProcess = authProcess;
        // i18n common
        this.titleText = 'CREATE AN ACCOUNT';
        this.readAndAcceptText = 'I read and accept the';
        this.termsAndConditionsText = 'terms and conditions';
        this.privacyPolicyText = 'privacy policy';
        this.createAccountButtonText = 'CREATE AN ACCOUNT';
        this.alreadyHaveAccountText = 'Already have an account?';
        this.loginButtonText = 'LOGIN';
        // i18n name
        this.nameText = 'Name';
        this.nameErrorRequiredText = 'Name is required';
        // i18n email
        this.emailText = 'Email';
        this.emailErrorRequiredText = 'Email is required';
        this.emailErrorPatternText = 'Please enter a valid email address';
        // i18n password
        this.passwordText = 'Password';
        this.passwordErrorRequiredText = 'Password is required';
        this.passwordConfirmationText = 'Password Confirmation';
        this.passwordConfirmationErrorRequiredText = 'Password confirmation is required';
        this.passwordErrorMatchText = 'Password must match';
        // tslint:disable-next-line:no-output-on-prefix
        this.onLoginRequested = new EventEmitter();
        this.authenticationError = false;
        // Set the private defaults
        this.unsubscribeAll = new Subject();
        this.onSuccess = authProcess.onSuccessEmitter;
        this.onError = authProcess.onErrorEmitter;
    }
    Object.defineProperty(NgxAuthFirebaseuiRegisterComponent.prototype, "color", {
        get: function () {
            return this.authenticationError ? 'warn' : 'primary';
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NgxAuthFirebaseuiRegisterComponent.prototype, "colorAccent", {
        get: function () {
            return this.authenticationError ? 'warn' : 'accent';
        },
        enumerable: true,
        configurable: true
    });
    NgxAuthFirebaseuiRegisterComponent.prototype.ngOnInit = function () {
        var _this = this;
        if (isPlatformBrowser(this.platformId)) {
            this.onErrorSubscription = this.onError.subscribe(function () { return _this.authenticationError = true; });
        }
        this.registerForm = this.formBuilder.group({
            name: ['', Validators.required],
            email: ['', [Validators.required, Validators.email]],
            password: ['', Validators.required],
            passwordConfirm: ['', [Validators.required, confirmPasswordValidator]],
            tos: [''],
            privacyPolicy: ['']
        });
        // If tos or privacy policy url set, ensure that the two form items are required
        if (this.tosUrl) {
            this.registerForm.controls.tos.setValidators(Validators.requiredTrue);
        }
        if (this.privacyPolicyUrl) {
            this.registerForm.controls.privacyPolicy.setValidators(Validators.requiredTrue);
        }
        // Update the validity of the 'passwordConfirm' field
        // when the 'password' field changes
        this.registerForm
            .controls
            .password
            .valueChanges.pipe(takeUntil(this.unsubscribeAll))
            .subscribe(function () {
            _this.registerForm.controls.passwordConfirm.updateValueAndValidity();
        });
    };
    /**
     * On destroy
     */
    NgxAuthFirebaseuiRegisterComponent.prototype.ngOnDestroy = function () {
        // Unsubscribe from all subscriptions
        this.unsubscribeAll.next();
        this.unsubscribeAll.complete();
    };
    NgxAuthFirebaseuiRegisterComponent.prototype.createAccount = function () {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.authProcess.signUp(this.registerForm.controls.name.value, {
                            email: this.registerForm.controls.email.value,
                            password: this.registerForm.controls.password.value
                        })];
                    case 1: return [2 /*return*/, _a.sent()];
                }
            });
        });
    };
    NgxAuthFirebaseuiRegisterComponent.ctorParameters = function () { return [
        { type: Object, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] },
        { type: FormBuilder },
        { type: AuthProcessService }
    ]; };
    __decorate([
        Input()
    ], NgxAuthFirebaseuiRegisterComponent.prototype, "logoUrl", void 0);
    __decorate([
        Input()
    ], NgxAuthFirebaseuiRegisterComponent.prototype, "appearance", void 0);
    __decorate([
        Input()
    ], NgxAuthFirebaseuiRegisterComponent.prototype, "tosUrl", void 0);
    __decorate([
        Input()
    ], NgxAuthFirebaseuiRegisterComponent.prototype, "privacyPolicyUrl", void 0);
    __decorate([
        Input()
    ], NgxAuthFirebaseuiRegisterComponent.prototype, "titleText", void 0);
    __decorate([
        Input()
    ], NgxAuthFirebaseuiRegisterComponent.prototype, "readAndAcceptText", void 0);
    __decorate([
        Input()
    ], NgxAuthFirebaseuiRegisterComponent.prototype, "termsAndConditionsText", void 0);
    __decorate([
        Input()
    ], NgxAuthFirebaseuiRegisterComponent.prototype, "privacyPolicyText", void 0);
    __decorate([
        Input()
    ], NgxAuthFirebaseuiRegisterComponent.prototype, "createAccountButtonText", void 0);
    __decorate([
        Input()
    ], NgxAuthFirebaseuiRegisterComponent.prototype, "alreadyHaveAccountText", void 0);
    __decorate([
        Input()
    ], NgxAuthFirebaseuiRegisterComponent.prototype, "loginButtonText", void 0);
    __decorate([
        Input()
    ], NgxAuthFirebaseuiRegisterComponent.prototype, "nameText", void 0);
    __decorate([
        Input()
    ], NgxAuthFirebaseuiRegisterComponent.prototype, "nameErrorRequiredText", void 0);
    __decorate([
        Input()
    ], NgxAuthFirebaseuiRegisterComponent.prototype, "emailText", void 0);
    __decorate([
        Input()
    ], NgxAuthFirebaseuiRegisterComponent.prototype, "emailErrorRequiredText", void 0);
    __decorate([
        Input()
    ], NgxAuthFirebaseuiRegisterComponent.prototype, "emailErrorPatternText", void 0);
    __decorate([
        Input()
    ], NgxAuthFirebaseuiRegisterComponent.prototype, "passwordText", void 0);
    __decorate([
        Input()
    ], NgxAuthFirebaseuiRegisterComponent.prototype, "passwordErrorRequiredText", void 0);
    __decorate([
        Input()
    ], NgxAuthFirebaseuiRegisterComponent.prototype, "passwordConfirmationText", void 0);
    __decorate([
        Input()
    ], NgxAuthFirebaseuiRegisterComponent.prototype, "passwordConfirmationErrorRequiredText", void 0);
    __decorate([
        Input()
    ], NgxAuthFirebaseuiRegisterComponent.prototype, "passwordErrorMatchText", void 0);
    __decorate([
        Output()
    ], NgxAuthFirebaseuiRegisterComponent.prototype, "onSuccess", void 0);
    __decorate([
        Output()
    ], NgxAuthFirebaseuiRegisterComponent.prototype, "onError", void 0);
    __decorate([
        Output()
    ], NgxAuthFirebaseuiRegisterComponent.prototype, "onLoginRequested", void 0);
    NgxAuthFirebaseuiRegisterComponent = __decorate([
        Component({
            selector: 'ngx-auth-firebaseui-register',
            template: "<div fxLayout=\"column\" id=\"register\">\n\n  <div fxLayout=\"column\" fxLayoutAlign=\"center center\" id=\"register-form-wrapper\">\n\n    <div [@animateStagger]=\"{ value: '50' }\" id=\"register-form\">\n\n      <div *ngIf=\"logoUrl\" class=\"logo\">\n        <img [@animate]=\"{ value: '*', params: { x: '50px' } }\" [src]=\"logoUrl\" alt=\"logo\">\n      </div>\n\n      <div [@animate]=\"{ value: '*', params: { x: '-50px' } }\" class=\"title\">{{titleText}}</div>\n\n      <form [@animate]=\"{value:'*',params:{duration:'300ms',y:'100px'}}\" [formGroup]=\"registerForm\" name=\"registerForm\"\n            novalidate>\n\n        <mat-form-field [@animate]=\"{ value: '*', params: { x: '50px' } }\" [appearance]=\"appearance\">\n          <input [placeholder]=\"nameText\" formControlName=\"name\" matInput/>\n          <mat-icon [color]=\"color\" matSuffix>person</mat-icon>\n          <mat-error>\n            {{nameErrorRequiredText}}\n          </mat-error>\n        </mat-form-field>\n\n        <mat-form-field [@animate]=\"{ value: '*', params: { x: '50px' } }\" [appearance]=\"appearance\">\n          <input [placeholder]=\"emailText\" formControlName=\"email\" matInput/>\n          <mat-icon [color]=\"color\" matSuffix>email</mat-icon>\n          <mat-error *ngIf=\"registerForm.get('email')?.hasError('required')\">\n            {{emailErrorRequiredText}}\n          </mat-error>\n          <mat-error *ngIf=\"registerForm.get('email')?.hasError('email')\">\n            {{emailErrorPatternText}}\n          </mat-error>\n        </mat-form-field>\n\n        <mat-form-field [@animate]=\"{ value: '*', params: { x: '50px' } }\" [appearance]=\"appearance\">\n          <input [placeholder]=\"passwordText\" formControlName=\"password\" matInput type=\"password\"/>\n          <mat-icon [color]=\"color\" matSuffix>lock</mat-icon>\n          <mat-error>\n            {{passwordErrorRequiredText}}\n          </mat-error>\n        </mat-form-field>\n\n        <mat-form-field [@animate]=\"{ value: '*', params: { x: '50px' } }\" [appearance]=\"appearance\">\n          <input [placeholder]=\"passwordConfirmationText\" formControlName=\"passwordConfirm\" matInput type=\"password\"/>\n          <mat-icon [color]=\"color\" matSuffix>lock</mat-icon>\n          <mat-error *ngIf=\"registerForm.get('passwordConfirm')?.hasError('required')\">\n            {{passwordConfirmationErrorRequiredText}}\n          </mat-error>\n          <mat-error\n            *ngIf=\"\n              !registerForm.get('passwordConfirm')?.hasError('required') &&\n              registerForm.get('passwordConfirm')?.hasError('passwordsNotMatching')\n            \">\n            {{passwordErrorMatchText}}\n          </mat-error>\n        </mat-form-field>\n\n        <div *ngIf=\"this.tosUrl\">\n          <mat-checkbox aria-label=\"{{readAndAcceptText}}\" formControlName=\"tos\" required>\n            <span>{{readAndAcceptText}}</span>\n            <a target=\"_blank\" [href]=\"this.tosUrl\">\n                {{termsAndConditionsText}}\n            </a>\n          </mat-checkbox>\n        </div>\n\n        <div *ngIf=\"this.privacyPolicyUrl\">\n          <mat-checkbox aria-label=\"{{readAndAcceptText}}\" formControlName=\"privacyPolicy\" required>\n            <span>{{readAndAcceptText}}</span>\n            <a target=\"_blank\" [href]=\"this.privacyPolicyUrl\">\n                {{privacyPolicyText}}\n            </a>\n          </mat-checkbox>\n        </div>\n\n        <button (click)=\"createAccount()\"\n                [color]=\"colorAccent\"\n                [disabled]=\"registerForm.invalid\"\n                aria-label=\"CREATE AN ACCOUNT\"\n                class=\"submit-button\"\n                id=\"createAccountButton\"\n                mat-raised-button>\n          {{createAccountButtonText}}\n        </button>\n      </form>\n\n      <div [@animate]=\"{value:'*',params:{duration:'300ms',y:'100px'}}\" class=\"register\" fxLayout=\"column\"\n           fxLayoutAlign=\"center center\">\n        <span [@animate]=\"{ value: '*', params: { x: '100px' } }\" class=\"text\">\n          {{alreadyHaveAccountText}}\n        </span>\n        <button (click)=\"onLoginRequested.emit()\"\n                [@animate]=\"{ value: '*', params: { x: '-100px' } }\"\n                [color]=\"colorAccent\"\n                id=\"loginButton\"\n                mat-button\n                type=\"button\">\n          {{loginButtonText}}\n        </button>\n      </div>\n\n    </div>\n  </div>\n</div>\n",
            encapsulation: ViewEncapsulation.None,
            animations: NgxAuthFirebaseuiAnimations,
            styles: ["ngx-auth-firebaseui-register #register{width:100%;background-size:cover}ngx-auth-firebaseui-register #register #register-form-wrapper{flex:1 0 auto;padding:32px}ngx-auth-firebaseui-register #register #register-form-wrapper #register-form{width:384px;max-width:384px;padding:32px;text-align:center}ngx-auth-firebaseui-register #register #register-form-wrapper #register-form .logo{width:128px;margin:32px auto}ngx-auth-firebaseui-register #register #register-form-wrapper #register-form .title{font-size:20px;margin:16px 0 32px}ngx-auth-firebaseui-register #register #register-form-wrapper #register-form form{width:100%;text-align:left}ngx-auth-firebaseui-register #register #register-form-wrapper #register-form form mat-form-field{width:100%}ngx-auth-firebaseui-register #register #register-form-wrapper #register-form form mat-checkbox{margin:0}ngx-auth-firebaseui-register #register #register-form-wrapper #register-form form .terms{margin:16px 0 32px}ngx-auth-firebaseui-register #register #register-form-wrapper #register-form form .terms a{font-size:16px;margin-left:4px}ngx-auth-firebaseui-register #register #register-form-wrapper #register-form form .submit-button{width:220px;margin:16px auto;display:block}@media screen and (max-width:599px){ngx-auth-firebaseui-register #register #register-form-wrapper{padding:16px}ngx-auth-firebaseui-register #register #register-form-wrapper #register-form{padding:24px;width:100%}ngx-auth-firebaseui-register #register #register-form-wrapper #register-form form .submit-button{width:90%}ngx-auth-firebaseui-register #register #register-form-wrapper #register-form button{width:80%}}ngx-auth-firebaseui-register #register #register-form-wrapper #register-form .register{margin:32px auto 24px;font-weight:500}ngx-auth-firebaseui-register #register #register-form-wrapper #register-form .register .text{margin-right:8px}ngx-auth-firebaseui-register #register #register-form-wrapper #register-form .separator{font-size:15px;font-weight:600;margin:24px auto;position:relative;overflow:hidden;width:100px}ngx-auth-firebaseui-register #register #register-form-wrapper #register-form .separator .text{display:inline-flex;position:relative;padding:0 8px;z-index:9999}ngx-auth-firebaseui-register #register #register-form-wrapper #register-form .separator .text:after,ngx-auth-firebaseui-register #register #register-form-wrapper #register-form .separator .text:before{content:\"\";display:block;width:30px;position:absolute;top:10px;border-top:1px solid}ngx-auth-firebaseui-register #register #register-form-wrapper #register-form .separator .text:before{right:100%}ngx-auth-firebaseui-register #register #register-form-wrapper #register-form .separator .text:after{left:100%}ngx-auth-firebaseui-register #register #register-form-wrapper #register-form button.facebook,ngx-auth-firebaseui-register #register #register-form-wrapper #register-form button.google{width:192px;text-transform:none;color:#fff;font-size:13px}ngx-auth-firebaseui-register #register #register-form-wrapper #register-form button.google{background-color:#d73d32;margin-bottom:8px}ngx-auth-firebaseui-register #register #register-form-wrapper #register-form button.facebook{background-color:#3f5c9a}ngx-auth-firebaseui-register ::ng-deep .mat-checkbox-label{display:flex;flex-wrap:wrap}"]
        }),
        __param(0, Inject(PLATFORM_ID))
    ], NgxAuthFirebaseuiRegisterComponent);
    return NgxAuthFirebaseuiRegisterComponent;
}());
export { NgxAuthFirebaseuiRegisterComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LWF1dGgtZmlyZWJhc2V1aS1yZWdpc3Rlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZ3gtYXV0aC1maXJlYmFzZXVpLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvbmd4LWF1dGgtZmlyZWJhc2V1aS1yZWdpc3Rlci9uZ3gtYXV0aC1maXJlYmFzZXVpLXJlZ2lzdGVyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFDLFNBQVMsRUFBRSxZQUFZLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBcUIsTUFBTSxFQUFFLFdBQVcsRUFBRSxpQkFBaUIsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUNoSSxPQUFPLEVBQUMsZUFBZSxFQUFFLFdBQVcsRUFBRSxTQUFTLEVBQUUsZ0JBQWdCLEVBQUUsV0FBVyxFQUFFLFVBQVUsRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBQ2xILE9BQU8sRUFBQyxPQUFPLEVBQWUsTUFBTSxNQUFNLENBQUM7QUFDM0MsT0FBTyxFQUFDLFNBQVMsRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBRXpDLE9BQU8sRUFBQywyQkFBMkIsRUFBQyxNQUFNLGtCQUFrQixDQUFDO0FBQzdELE9BQU8sRUFBQyxrQkFBa0IsRUFBQyxNQUFNLHFDQUFxQyxDQUFDO0FBQ3ZFLE9BQU8sRUFBQyxpQkFBaUIsRUFBQyxNQUFNLGlCQUFpQixDQUFDO0FBSWxELE1BQU0sQ0FBQyxJQUFNLHdCQUF3QixHQUFnQixVQUFDLE9BQXdCO0lBQzVFLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxJQUFJLENBQUMsT0FBTyxFQUFFO1FBQy9CLE9BQU8sSUFBSSxDQUFDO0tBQ2I7SUFFRCxJQUFNLFFBQVEsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUNoRCxJQUFNLGVBQWUsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFD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LE1BQU0sRUFBRTt1RUFBYztJQUViO1FBQVQsTUFBTSxFQUFFO2dGQUFpRTtJQXRDL0Qsa0NBQWtDO1FBUDlDLFNBQVMsQ0FBQztZQUNULFFBQVEsRUFBRSw4QkFBOEI7WUFDeEMsNDZJQUE0RDtZQUU1RCxhQUFhLEVBQUUsaUJBQWlCLENBQUMsSUFBSTtZQUNyQyxVQUFVLEVBQUUsMkJBQTJCOztTQUN4QyxDQUFDO1FBaURhLFdBQUEsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFBO09BaERyQixrQ0FBa0MsQ0FzSDlDO0lBQUQseUNBQUM7Q0FBQSxBQXRIRCxJQXNIQztTQXRIWSxrQ0FBa0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NvbXBvbmVudCwgRXZlbnRFbWl0dGVyLCBJbmplY3QsIElucHV0LCBPbkRlc3Ryb3ksIE9uSW5pdCwgT3V0cHV0LCBQTEFURk9STV9JRCwgVmlld0VuY2Fwc3VsYXRpb259IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtBYnN0cmFjdENvbnRyb2wsIEZvcm1CdWlsZGVyLCBGb3JtR3JvdXAsIFZhbGlkYXRpb25FcnJvcnMsIFZhbGlkYXRvckZuLCBWYWxpZGF0b3JzfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQge1N1YmplY3QsIFN1YnNjcmlwdGlvbn0gZnJvbSAncnhqcyc7XG5pbXBvcnQge3Rha2VVbnRpbH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5pbXBvcnQge05neEF1dGhGaXJlYmFzZXVpQW5pbWF0aW9uc30gZnJvbSAnLi4vLi4vYW5pbWF0aW9ucyc7XG5pbXBvcnQge0F1dGhQcm9jZXNzU2VydmljZX0gZnJvbSAnLi4vLi4vc2VydmljZXMvYXV0aC1wcm9jZXNzLnNlcnZpY2UnO1xuaW1wb3J0IHtpc1BsYXRmb3JtQnJvd3Nlcn0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7TWF0Rm9ybUZpZWxkQXBwZWFyYW5jZX0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvZm9ybS1maWVsZCc7XG5pbXBvcnQge1RoZW1lUGFsZXR0ZX0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvY29yZSc7XG5cbmV4cG9ydCBjb25zdCBjb25maXJtUGFzc3dvcmRWYWxpZGF0b3I6IFZhbGlkYXRvckZuID0gKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IFZhbGlkYXRpb25FcnJvcnMgfCBudWxsID0+IHtcbiAgaWYgKCFjb250cm9sLnBhcmVudCB8fCAhY29udHJvbCkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgY29uc3QgcGFzc3dvcmQgPSBjb250cm9sLnBhcmVudC5nZXQoJ3Bhc3N3b3JkJyk7XG4gIGNvbnN0IHBhc3N3b3JkQ29uZmlybSA9IGNvbnRyb2wucGFyZW50LmdldCgncGFzc3dvcmRDb25maXJtJyk7XG5cbiAgaWYgKCFwYXNzd29yZCB8fCAhcGFzc3dvcmRDb25maXJtKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBpZiAocGFzc3dvcmRDb25maXJtLnZhbHVlID09PSAnJykge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgaWYgKHBhc3N3b3JkLnZhbHVlID09PSBwYXNzd29yZENvbmZpcm0udmFsdWUpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHJldHVybiB7cGFzc3dvcmRzTm90TWF0Y2hpbmc6IHRydWV9O1xufTtcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbmd4LWF1dGgtZmlyZWJhc2V1aS1yZWdpc3RlcicsXG4gIHRlbXBsYXRlVXJsOiAnLi9uZ3gtYXV0aC1maXJlYmFzZXVpLXJlZ2lzdGVyLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vbmd4LWF1dGgtZmlyZWJhc2V1aS1yZWdpc3Rlci5jb21wb25lbnQuc2NzcyddLFxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxuICBhbmltYXRpb25zOiBOZ3hBdXRoRmlyZWJhc2V1aUFuaW1hdGlvbnNcbn0pXG5leHBvcnQgY2xhc3MgTmd4QXV0aEZpcmViYXNldWlSZWdpc3RlckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcblxuICBASW5wdXQoKSBsb2dvVXJsOiBzdHJpbmc7XG4gIEBJbnB1dCgpIGFwcGVhcmFuY2U6IE1hdEZvcm1GaWVsZEFwcGVhcmFuY2U7XG4gIEBJbnB1dCgpIHRvc1VybDogc3RyaW5nO1xuICBASW5wdXQoKSBwcml2YWN5UG9saWN5VXJsOiBzdHJpbmc7XG5cbiAgLy8gaTE4biBjb21tb25cbiAgQElucHV0KCkgdGl0bGVUZXh0ID0gJ0NSRUFURSBBTiBBQ0NPVU5UJztcbiAgQElucHV0KCkgcmVhZEFuZEFjY2VwdFRleHQgPSAnSSByZWFkIGFuZCBhY2NlcHQgdGhlJztcbiAgQElucHV0KCkgdGVybXNBbmRDb25kaXRpb25zVGV4dCA9ICd0ZXJtcyBhbmQgY29uZGl0aW9ucyc7XG4gIEBJbnB1dCgpIHByaXZhY3lQb2xpY3lUZXh0ID0gJ3ByaXZhY3kgcG9saWN5JztcbiAgQElucHV0KCkgY3JlYXRlQWNjb3VudEJ1dHRvblRleHQgPSAnQ1JFQVRFIEFOIEFDQ09VTlQnO1xuICBASW5wdXQoKSBhbHJlYWR5SGF2ZUFjY291bnRUZXh0ID0gJ0FscmVhZHkgaGF2ZSBhbiBhY2NvdW50Pyc7XG4gIEBJbnB1dCgpIGxvZ2luQnV0dG9uVGV4dCA9ICdMT0dJTic7XG5cbiAgLy8gaTE4biBuYW1lXG4gIEBJbnB1dCgpIG5hbWVUZXh0ID0gJ05hbWUnO1xuICBASW5wdXQoKSBuYW1lRXJyb3JSZXF1aXJlZFRleHQgPSAnTmFtZSBpcyByZXF1aXJlZCc7XG5cbiAgLy8gaTE4biBlbWFpbFxuICBASW5wdXQoKSBlbWFpbFRleHQgPSAnRW1haWwnO1xuICBASW5wdXQoKSBlbWFpbEVycm9yUmVxdWlyZWRUZXh0ID0gJ0VtYWlsIGlzIHJlcXVpcmVkJztcbiAgQElucHV0KCkgZW1haWxFcnJvclBhdHRlcm5UZXh0ID0gJ1BsZWFzZSBlbnRlciBhIHZhbGlkIGVtYWlsIGFkZHJlc3MnO1xuXG4gIC8vIGkxOG4gcGFzc3dvcmRcbiAgQElucHV0KCkgcGFzc3dvcmRUZXh0ID0gJ1Bhc3N3b3JkJztcbiAgQElucHV0KCkgcGFzc3dvcmRFcnJvclJlcXVpcmVkVGV4dCA9ICdQYXNzd29yZCBpcyByZXF1aXJlZCc7XG4gIEBJbnB1dCgpIHBhc3N3b3JkQ29uZmlybWF0aW9uVGV4dCA9ICdQYXNzd29yZCBDb25maXJtYXRpb24nO1xuICBASW5wdXQoKSBwYXNzd29yZENvbmZpcm1hdGlvbkVycm9yUmVxdWlyZWRUZXh0ID0gJ1Bhc3N3b3JkIGNvbmZpcm1hdGlvbiBpcyByZXF1aXJlZCc7XG4gIEBJbnB1dCgpIHBhc3N3b3JkRXJyb3JNYXRjaFRleHQgPSAnUGFzc3dvcmQgbXVzdCBtYXRjaCc7XG5cbiAgLy8gRXZlbnRzXG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1vdXRwdXQtb24tcHJlZml4XG4gIEBPdXRwdXQoKSBvblN1Y2Nlc3M6IGFueTtcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLW91dHB1dC1vbi1wcmVmaXhcbiAgQE91dHB1dCgpIG9uRXJyb3I6IGFueTtcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLW91dHB1dC1vbi1wcmVmaXhcbiAgQE91dHB1dCgpIG9uTG9naW5SZXF1ZXN0ZWQ6IEV2ZW50RW1pdHRlcjx2b2lkPiA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcblxuICByZWdpc3RlckZvcm06IEZvcm1Hcm91cDtcbiAgb25FcnJvclN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuICBhdXRoZW50aWNhdGlvbkVycm9yID0gZmFsc2U7XG5cbiAgLy8gUHJpdmF0ZVxuICBwcml2YXRlIHVuc3Vic2NyaWJlQWxsOiBTdWJqZWN0PGFueT47XG5cbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOmJhbi10eXBlc1xuICBjb25zdHJ1Y3RvcihASW5qZWN0KFBMQVRGT1JNX0lEKSBwcml2YXRlIHBsYXRmb3JtSWQ6IE9iamVjdCxcbiAgICAgICAgICAgICAgcHJpdmF0ZSBmb3JtQnVpbGRlcjogRm9ybUJ1aWxkZXIsXG4gICAgICAgICAgICAgIHB1YmxpYyBhdXRoUHJvY2VzczogQXV0aFByb2Nlc3NTZXJ2aWNlKSB7XG4gICAgLy8gQ29uZmlndXJlIHRoZSBsYXlvdXRcblxuICAgIC8vIFNldCB0aGUgcHJpdmF0ZSBkZWZhdWx0c1xuICAgIHRoaXMudW5zdWJzY3JpYmVBbGwgPSBuZXcgU3ViamVjdCgpO1xuICAgIHRoaXMub25TdWNjZXNzID0gYXV0aFByb2Nlc3Mub25TdWNjZXNzRW1pdHRlcjtcbiAgICB0aGlzLm9uRXJyb3IgPSBhdXRoUHJvY2Vzcy5vbkVycm9yRW1pdHRlcjtcbiAgfVxuXG4gIGdldCBjb2xvcigpOiBzdHJpbmcgfCBUaGVtZVBhbGV0dGUge1xuICAgIHJldHVybiB0aGlzLmF1dGhlbnRpY2F0aW9uRXJyb3IgPyAnd2FybicgOiAncHJpbWFyeSc7XG4gIH1cblxuICBnZXQgY29sb3JBY2NlbnQoKTogc3RyaW5nIHwgVGhlbWVQYWxldHRlIHtcbiAgICByZXR1cm4gdGhpcy5hdXRoZW50aWNhdGlvbkVycm9yID8gJ3dhcm4nIDogJ2FjY2VudCc7XG4gIH1cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICBpZiAoaXNQbGF0Zm9ybUJyb3dzZXIodGhpcy5wbGF0Zm9ybUlkKSkge1xuICAgICAgdGhpcy5vbkVycm9yU3Vic2NyaXB0aW9uID0gdGhpcy5vbkVycm9yLnN1YnNjcmliZSgoKSA9PiB0aGlzLmF1dGhlbnRpY2F0aW9uRXJyb3IgPSB0cnVlKTtcbiAgICB9XG4gICAgdGhpcy5yZWdpc3RlckZvcm0gPSB0aGlzLmZvcm1CdWlsZGVyLmdyb3VwKHtcbiAgICAgIG5hbWU6IFsnJywgVmFsaWRhdG9ycy5yZXF1aXJlZF0sXG4gICAgICBlbWFpbDogWycnLCBbVmFsaWRhdG9ycy5yZXF1aXJlZCwgVmFsaWRhdG9ycy5lbWFpbF1dLFxuICAgICAgcGFzc3dvcmQ6IFsnJywgVmFsaWRhdG9ycy5yZXF1aXJlZF0sXG4gICAgICBwYXNzd29yZENvbmZpcm06IFsnJywgW1ZhbGlkYXRvcnMucmVxdWlyZWQsIGNvbmZpcm1QYXNzd29yZFZhbGlkYXRvcl1dLFxuICAgICAgdG9zOiBbJyddLFxuICAgICAgcHJpdmFjeVBvbGljeTogWycnXVxuICAgIH0pO1xuXG4gICAgLy8gSWYgdG9zIG9yIHByaXZhY3kgcG9saWN5IHVybCBzZXQsIGVuc3VyZSB0aGF0IHRoZSB0d28gZm9ybSBpdGVtcyBhcmUgcmVxdWlyZWRcbiAgICBpZiAodGhpcy50b3NVcmwpIHtcbiAgICAgIHRoaXMucmVnaXN0ZXJGb3JtLmNvbnRyb2xzLnRvcy5zZXRWYWxpZGF0b3JzKFZhbGlkYXRvcnMucmVxdWlyZWRUcnVlKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5wcml2YWN5UG9saWN5VXJsKSB7XG4gICAgICB0aGlzLnJlZ2lzdGVyRm9ybS5jb250cm9scy5wcml2YWN5UG9saWN5LnNldFZhbGlkYXRvcnMoVmFsaWRhdG9ycy5yZXF1aXJlZFRydWUpO1xuICAgIH1cblxuICAgIC8vIFVwZGF0ZSB0aGUgdmFsaWRpdHkgb2YgdGhlICdwYXNzd29yZENvbmZpcm0nIGZpZWxkXG4gICAgLy8gd2hlbiB0aGUgJ3Bhc3N3b3JkJyBmaWVsZCBjaGFuZ2VzXG4gICAgdGhpcy5yZWdpc3RlckZvcm1cbiAgICAgIC5jb250cm9sc1xuICAgICAgLnBhc3N3b3JkXG4gICAgICAudmFsdWVDaGFuZ2VzLnBpcGUodGFrZVVudGlsKHRoaXMudW5zdWJzY3JpYmVBbGwpKVxuICAgICAgLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXJGb3JtLmNvbnRyb2xzLnBhc3N3b3JkQ29uZmlybS51cGRhdGVWYWx1ZUFuZFZhbGlkaXR5KCk7XG4gICAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBPbiBkZXN0cm95XG4gICAqL1xuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICAvLyBVbnN1YnNjcmliZSBmcm9tIGFsbCBzdWJzY3JpcHRpb25zXG4gICAgdGhpcy51bnN1YnNjcmliZUFsbC5uZXh0KCk7XG4gICAgdGhpcy51bnN1YnNjcmliZUFsbC5jb21wbGV0ZSgpO1xuICB9XG5cbiAgYXN5bmMgY3JlYXRlQWNjb3VudCgpIHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5hdXRoUHJvY2Vzcy5zaWduVXAoXG4gICAgICB0aGlzLnJlZ2lzdGVyRm9ybS5jb250cm9scy5uYW1lLnZhbHVlLFxuICAgICAge1xuICAgICAgICBlbWFpbDogdGhpcy5yZWdpc3RlckZvcm0uY29udHJvbHMuZW1haWwudmFsdWUsXG4gICAgICAgIHBhc3N3b3JkOiB0aGlzLnJlZ2lzdGVyRm9ybS5jb250cm9scy5wYXNzd29yZC52YWx1ZVxuICAgICAgfVxuICAgICk7XG4gIH1cbn1cbiJdfQ==
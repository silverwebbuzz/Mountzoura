import { __awaiter, __decorate, __generator } from "tslib";
import { Component, EventEmitter, Input, Output } from '@angular/core';
import { AngularFireAuth } from '@angular/fire/auth';
import { MatDialog } from '@angular/material/dialog';
import { UserComponent } from '..';
var NgxAuthFirebaseuiAvatarComponent = /** @class */ (function () {
    function NgxAuthFirebaseuiAvatarComponent(afa, dialog) {
        this.afa = afa;
        this.dialog = dialog;
        this.layout = 'default';
        this.canLogout = true;
        this.canViewAccount = true;
        this.canDeleteAccount = true;
        this.canEditAccount = true;
        this.textProfile = 'Profile';
        this.textSignOut = 'Sign Out';
        // tslint:disable-next-line:no-output-on-prefix
        this.onSignOut = new EventEmitter();
    }
    NgxAuthFirebaseuiAvatarComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.user$ = this.afa.user;
        this.user$.subscribe(function (user) {
            _this.user = user;
            _this.displayNameInitials = user ? _this.getDisplayNameInitials(user.displayName) : null;
        });
    };
    NgxAuthFirebaseuiAvatarComponent.prototype.getDisplayNameInitials = function (displayName) {
        if (!displayName) {
            return null;
        }
        var initialsRegExp = displayName.match(/\b\w/g) || [];
        var initials = ((initialsRegExp.shift() || '') + (initialsRegExp.pop() || '')).toUpperCase();
        return initials;
    };
    NgxAuthFirebaseuiAvatarComponent.prototype.openProfile = function () {
        var dialogRef = this.dialog.open(UserComponent);
        var instance = dialogRef.componentInstance;
        instance.canDeleteAccount = this.canDeleteAccount;
        instance.canEditAccount = this.canEditAccount;
    };
    NgxAuthFirebaseuiAvatarComponent.prototype.signOut = function () {
        return __awaiter(this, void 0, void 0, function () {
            var e_1;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 2, , 3]);
                        return [4 /*yield*/, this.afa.signOut()];
                    case 1:
                        _a.sent();
                        // Sign-out successful.
                        this.onSignOut.emit();
                        return [3 /*break*/, 3];
                    case 2:
                        e_1 = _a.sent();
                        // An error happened.
                        console.error('An error happened while signing out!', e_1);
                        return [3 /*break*/, 3];
                    case 3: return [2 /*return*/];
                }
            });
        });
    };
    NgxAuthFirebaseuiAvatarComponent.ctorParameters = function () { return [
        { type: AngularFireAuth },
        { type: MatDialog }
    ]; };
    __decorate([
        Input()
    ], NgxAuthFirebaseuiAvatarComponent.prototype, "layout", void 0);
    __decorate([
        Input()
    ], NgxAuthFirebaseuiAvatarComponent.prototype, "canLogout", void 0);
    __decorate([
        Input()
    ], NgxAuthFirebaseuiAvatarComponent.prototype, "links", void 0);
    __decorate([
        Input()
    ], NgxAuthFirebaseuiAvatarComponent.prototype, "canViewAccount", void 0);
    __decorate([
        Input()
    ], NgxAuthFirebaseuiAvatarComponent.prototype, "canDeleteAccount", void 0);
    __decorate([
        Input()
    ], NgxAuthFirebaseuiAvatarComponent.prototype, "canEditAccount", void 0);
    __decorate([
        Input()
    ], NgxAuthFirebaseuiAvatarComponent.prototype, "textProfile", void 0);
    __decorate([
        Input()
    ], NgxAuthFirebaseuiAvatarComponent.prototype, "textSignOut", void 0);
    __decorate([
        Output()
    ], NgxAuthFirebaseuiAvatarComponent.prototype, "onSignOut", void 0);
    NgxAuthFirebaseuiAvatarComponent = __decorate([
        Component({
            selector: 'ngx-auth-firebaseui-avatar',
            template: "<button *ngIf=\"user\"\n        class=\"ngx-auth-firebaseui-avatar-button\"\n        [matMenuTriggerFor]=\"posXMenu\"\n        [matTooltip]=\"user?.displayName\"\n        [style.background-image]=\"'url(' + user?.photoURL + ')'\"\n        aria-label=\"Open x-positioned menu\"\n        mat-mini-fab\n        style=\"background-size: cover\">\n  <span *ngIf=\"!user?.photoURL\">{{displayNameInitials || ''}}</span>\n</button>\n\n<mat-menu #posXMenu=\"matMenu\" class=\"before ngx-auth-firebaseui-avatar-menu\" xPosition=\"before\" >\n  <div fxLayout=\"row\" fxLayout.xs=\"column\" style=\"padding-left: 10px; padding-right: 10px\" [ngStyle]=\"{ 'padding-top.px': layout === 'default' ? 0 : 10 }\">\n    <button [style.background-image]=\"'url(' + user?.photoURL + ')'\"\n            mat-fab\n            style=\"background-size: cover\"\n            *ngIf=\"layout === 'default'\">\n      <span *ngIf=\"!user?.photoURL\">{{displayNameInitials || ''}}</span>\n    </button>\n    <div fxLayout=\"column\" style=\"padding-left: 10px; padding-right: 10px\">\n      <strong mat-card-title>{{user?.displayName}}</strong>\n      <em mat-card-subtitle style=\"font-style: italic\">{{user?.email}}</em>\n    </div>\n  </div>\n\n  <div fxFlex=\"100\" fxLayout=\"column\" [ngStyle]=\"{ 'padding-bottom.px': layout === 'default' ? 0 : 10 } \">\n    <div *ngFor=\"let menuItem of links\" class=\"links-menu\">\n      <button (click)=\"menuItem?.callback()\" mat-menu-item>\n        <mat-icon>{{menuItem?.icon}}</mat-icon>\n        {{menuItem?.text}}</button>\n    </div>\n    <button *ngIf=\"canViewAccount\" (click)=\"openProfile()\" color=\"primary\" fxLayoutAlign=\"center\" mat-raised-button>{{ textProfile }}\n    </button>\n    <button (click)=\"signOut()\" *ngIf=\"canLogout\" color=\"warn\" fxLayoutAlign=\"center\" mat-raised-button>{{ textSignOut }}\n    </button>\n  </div>\n</mat-menu>\n",
            styles: [".mat-raised-button{margin:.2rem 1rem}.links-menu{text-align:center}"]
        })
    ], NgxAuthFirebaseuiAvatarComponent);
    return NgxAuthFirebaseuiAvatarComponent;
}());
export { NgxAuthFirebaseuiAvatarComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LWF1dGgtZmlyZWJhc2V1aS1hdmF0YXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LWF1dGgtZmlyZWJhc2V1aS8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL25neC1hdXRoLWZpcmViYXNldWktYXZhdGFyL25neC1hdXRoLWZpcmViYXNldWktYXZhdGFyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFDLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFVLE1BQU0sRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUM3RSxPQUFPLEVBQUMsZUFBZSxFQUFDLE1BQU0sb0JBQW9CLENBQUM7QUFHbkQsT0FBTyxFQUFDLFNBQVMsRUFBQyxNQUFNLDBCQUEwQixDQUFDO0FBQ25ELE9BQU8sRUFBQyxhQUFhLEVBQUMsTUFBTSxJQUFJLENBQUM7QUFjakM7SUFrQ0UsMENBQW1CLEdBQW9CLEVBQ3BCLE1BQWlCO1FBRGpCLFFBQUcsR0FBSCxHQUFHLENBQWlCO1FBQ3BCLFdBQU0sR0FBTixNQUFNLENBQVc7UUFoQ3BDLFdBQU0sR0FBeUIsU0FBUyxDQUFDO1FBR3pDLGNBQVMsR0FBRyxJQUFJLENBQUM7UUFNakIsbUJBQWMsR0FBRyxJQUFJLENBQUM7UUFHdEIscUJBQWdCLEdBQUcsSUFBSSxDQUFDO1FBR3hCLG1CQUFjLEdBQUcsSUFBSSxDQUFDO1FBR3RCLGdCQUFXLEdBQUcsU0FBUyxDQUFDO1FBR3hCLGdCQUFXLEdBQUcsVUFBVSxDQUFDO1FBRXpCLCtDQUErQztRQUUvQyxjQUFTLEdBQXVCLElBQUksWUFBWSxFQUFFLENBQUM7SUFRbkQsQ0FBQztJQUVELG1EQUFRLEdBQVI7UUFBQSxpQkFNQztRQUxDLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUM7UUFDM0IsSUFBSSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsVUFBQyxJQUFVO1lBQzlCLEtBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1lBQ2pCLEtBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUksQ0FBQyxzQkFBc0IsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUN6RixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxpRUFBc0IsR0FBdEIsVUFBdUIsV0FBMEI7UUFDL0MsSUFBSSxDQUFDLFdBQVcsRUFBRTtZQUNoQixPQUFPLElBQUksQ0FBQztTQUNiO1FBQ0QsSUFBTSxjQUFjLEdBQXFCLFdBQVcsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQzFFLElBQU0sUUFBUSxHQUFHLENBQUMsQ0FBQyxjQUFjLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxDQUFDLEdBQUcsQ0FBQyxjQUFjLENBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUMvRixPQUFPLFFBQVEsQ0FBQztJQUNsQixDQUFDO0lBRUQsc0RBQVcsR0FBWDtRQUNFLElBQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQ2xELElBQU0sUUFBUSxHQUFHLFNBQVMsQ0FBQyxpQkFBaUIsQ0FBQztRQUM3QyxRQUFRLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDO1FBQ2xELFFBQVEsQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQztJQUNoRCxDQUFDO0lBRUssa0RBQU8sR0FBYjs7Ozs7Ozt3QkFFSSxxQkFBTSxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxFQUFBOzt3QkFBeEIsU0FBd0IsQ0FBQzt3QkFDekIsdUJBQXVCO3dCQUN2QixJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksRUFBRSxDQUFDOzs7O3dCQUV0QixxQkFBcUI7d0JBQ3JCLE9BQU8sQ0FBQyxLQUFLLENBQUMsc0NBQXNDLEVBQUUsR0FBQyxDQUFDLENBQUM7Ozs7OztLQUU1RDs7Z0JBckN1QixlQUFlO2dCQUNaLFNBQVM7O0lBaENwQztRQURDLEtBQUssRUFBRTtvRUFDaUM7SUFHekM7UUFEQyxLQUFLLEVBQUU7dUVBQ1M7SUFHakI7UUFEQyxLQUFLLEVBQUU7bUVBQ2M7SUFHdEI7UUFEQyxLQUFLLEVBQUU7NEVBQ2M7SUFHdEI7UUFEQyxLQUFLLEVBQUU7OEVBQ2dCO0lBR3hCO1FBREMsS0FBSyxFQUFFOzRFQUNjO0lBR3RCO1FBREMsS0FBSyxFQUFFO3lFQUNnQjtJQUd4QjtRQURDLEtBQUssRUFBRTt5RUFDaUI7SUFJekI7UUFEQyxNQUFNLEVBQUU7dUVBQzBDO0lBNUJ4QyxnQ0FBZ0M7UUFMNUMsU0FBUyxDQUFDO1lBQ1QsUUFBUSxFQUFFLDRCQUE0QjtZQUN0Qyx5MkRBQTBEOztTQUUzRCxDQUFDO09BQ1csZ0NBQWdDLENBd0U1QztJQUFELHVDQUFDO0NBQUEsQUF4RUQsSUF3RUM7U0F4RVksZ0NBQWdDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uSW5pdCwgT3V0cHV0fSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7QW5ndWxhckZpcmVBdXRofSBmcm9tICdAYW5ndWxhci9maXJlL2F1dGgnO1xuaW1wb3J0IHtVc2VyfSBmcm9tICdmaXJlYmFzZSc7XG5pbXBvcnQge09ic2VydmFibGV9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHtNYXREaWFsb2d9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL2RpYWxvZyc7XG5pbXBvcnQge1VzZXJDb21wb25lbnR9IGZyb20gJy4uJztcblxuZXhwb3J0IGludGVyZmFjZSBMaW5rTWVudUl0ZW0ge1xuICB0ZXh0OiBzdHJpbmc7XG4gIGljb24/OiBzdHJpbmc7XG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpiYW4tdHlwZXNcbiAgY2FsbGJhY2s/OiBGdW5jdGlvbjtcbn1cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbmd4LWF1dGgtZmlyZWJhc2V1aS1hdmF0YXInLFxuICB0ZW1wbGF0ZVVybDogJy4vbmd4LWF1dGgtZmlyZWJhc2V1aS1hdmF0YXIuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9uZ3gtYXV0aC1maXJlYmFzZXVpLWF2YXRhci5jb21wb25lbnQuc2NzcyddXG59KVxuZXhwb3J0IGNsYXNzIE5neEF1dGhGaXJlYmFzZXVpQXZhdGFyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcblxuICBASW5wdXQoKVxuICBsYXlvdXQ6ICdkZWZhdWx0JyB8ICdzaW1wbGUnID0gJ2RlZmF1bHQnO1xuXG4gIEBJbnB1dCgpXG4gIGNhbkxvZ291dCA9IHRydWU7XG5cbiAgQElucHV0KClcbiAgbGlua3M6IExpbmtNZW51SXRlbVtdO1xuXG4gIEBJbnB1dCgpXG4gIGNhblZpZXdBY2NvdW50ID0gdHJ1ZTtcblxuICBASW5wdXQoKVxuICBjYW5EZWxldGVBY2NvdW50ID0gdHJ1ZTtcblxuICBASW5wdXQoKVxuICBjYW5FZGl0QWNjb3VudCA9IHRydWU7XG5cbiAgQElucHV0KClcbiAgdGV4dFByb2ZpbGUgPSAnUHJvZmlsZSc7XG5cbiAgQElucHV0KClcbiAgdGV4dFNpZ25PdXQgPSAnU2lnbiBPdXQnO1xuXG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1vdXRwdXQtb24tcHJlZml4XG4gIEBPdXRwdXQoKVxuICBvblNpZ25PdXQ6IEV2ZW50RW1pdHRlcjx2b2lkPiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICB1c2VyOiBVc2VyO1xuICB1c2VyJDogT2JzZXJ2YWJsZTxVc2VyIHwgbnVsbD47XG4gIGRpc3BsYXlOYW1lSW5pdGlhbHM6IHN0cmluZyB8IG51bGw7XG5cbiAgY29uc3RydWN0b3IocHVibGljIGFmYTogQW5ndWxhckZpcmVBdXRoLFxuICAgICAgICAgICAgICBwdWJsaWMgZGlhbG9nOiBNYXREaWFsb2cpIHtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMudXNlciQgPSB0aGlzLmFmYS51c2VyO1xuICAgIHRoaXMudXNlciQuc3Vic2NyaWJlKCh1c2VyOiBVc2VyKSA9PiB7XG4gICAgICB0aGlzLnVzZXIgPSB1c2VyO1xuICAgICAgdGhpcy5kaXNwbGF5TmFtZUluaXRpYWxzID0gdXNlciA/IHRoaXMuZ2V0RGlzcGxheU5hbWVJbml0aWFscyh1c2VyLmRpc3BsYXlOYW1lKSA6IG51bGw7XG4gICAgfSk7XG4gIH1cblxuICBnZXREaXNwbGF5TmFtZUluaXRpYWxzKGRpc3BsYXlOYW1lOiBzdHJpbmcgfCBudWxsKTogc3RyaW5nIHwgbnVsbCB7XG4gICAgaWYgKCFkaXNwbGF5TmFtZSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IGluaXRpYWxzUmVnRXhwOiBSZWdFeHBNYXRjaEFycmF5ID0gZGlzcGxheU5hbWUubWF0Y2goL1xcYlxcdy9nKSB8fCBbXTtcbiAgICBjb25zdCBpbml0aWFscyA9ICgoaW5pdGlhbHNSZWdFeHAuc2hpZnQoKSB8fCAnJykgKyAoaW5pdGlhbHNSZWdFeHAucG9wKCkgfHwgJycpKS50b1VwcGVyQ2FzZSgpO1xuICAgIHJldHVybiBpbml0aWFscztcbiAgfVxuXG4gIG9wZW5Qcm9maWxlKCkge1xuICAgIGNvbnN0IGRpYWxvZ1JlZiA9IHRoaXMuZGlhbG9nLm9wZW4oVXNlckNvbXBvbmVudCk7XG4gICAgY29uc3QgaW5zdGFuY2UgPSBkaWFsb2dSZWYuY29tcG9uZW50SW5zdGFuY2U7XG4gICAgaW5zdGFuY2UuY2FuRGVsZXRlQWNjb3VudCA9IHRoaXMuY2FuRGVsZXRlQWNjb3VudDtcbiAgICBpbnN0YW5jZS5jYW5FZGl0QWNjb3VudCA9IHRoaXMuY2FuRWRpdEFjY291bnQ7XG4gIH1cblxuICBhc3luYyBzaWduT3V0KCkge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmFmYS5zaWduT3V0KCk7XG4gICAgICAvLyBTaWduLW91dCBzdWNjZXNzZnVsLlxuICAgICAgdGhpcy5vblNpZ25PdXQuZW1pdCgpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIC8vIEFuIGVycm9yIGhhcHBlbmVkLlxuICAgICAgY29uc29sZS5lcnJvcignQW4gZXJyb3IgaGFwcGVuZWQgd2hpbGUgc2lnbmluZyBvdXQhJywgZSk7XG4gICAgfVxuICB9XG59XG4iXX0=